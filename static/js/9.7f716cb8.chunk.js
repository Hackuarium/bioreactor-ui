(this["webpackJsonpbioreactor-ui"]=this["webpackJsonpbioreactor-ui"]||[]).push([[9],{198:function(e,t,r){"use strict";var n=function(){var e=new Error("Delay aborted");return e.name="AbortError",e},a=function(e){var t=e.clearTimeout,r=e.setTimeout,a=e.willResolve;return function(e){var i,s,u,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=o.value,l=o.signal;if(l&&l.aborted)return Promise.reject(n());var h=t||clearTimeout,f=function(){h(i),u(n())},d=function(){l&&l.removeEventListener("abort",f)},v=new Promise((function(t,n){s=function(){d(),a?t(c):n(c)},u=n,i=(r||setTimeout)(s,e)}));return l&&l.addEventListener("abort",f,{once:!0}),v.clear=function(){h(i),i=null,s()},v}},i=a({willResolve:!0});i.reject=a({willResolve:!1}),i.range=function(e,t,r){return i(function(e,t){return Math.floor(Math.random()*(t-e+1)+e)}(e,t),r)},i.createWithTimers=function(e){var t=e.clearTimeout,r=e.setTimeout,n=a({clearTimeout:t,setTimeout:r,willResolve:!0});return n.reject=a({clearTimeout:t,setTimeout:r,willResolve:!1}),n},e.exports=i,e.exports.default=i},375:function(e,t,r){"use strict";r.d(t,"a",(function(){return m}));var n=r(89),a=r(35),i=r.n(a),s=r(44),u=r(42),o=r(43),c=r(45),l=r(46),h=r(198),f=r.n(h),d=function(){function e(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(u.a)(this,e),this.currentTimeout=void 0,this.command=t,this.timeout=void 0===n.timeout?1e3:n.timeout,this.answer="",this.status=0,this.creationTimestamp=Date.now(),this.promise=new Promise((function(e,t){r.reject=t,r.resolve=e})),this.finishedPromise=new Promise((function(e){r.finished=e}))}return Object(o.a)(e,[{key:"isFinished",value:function(){return 4===this.status||5===this.status}},{key:"setTimeout",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){var e=this;this.currentTimeout&&clearTimeout(this.currentTimeout),this.currentTimeout=setTimeout((function(){4!==e.status&&5!==e.status&&(e.status=5,e.reject("Timeout"),e.finished())}),this.timeout)}))},{key:"start",value:function(){this.startTimestamp=Date.now(),this.status=1,this.setTimeout()}},{key:"appendAnswer",value:function(e){var t=(new TextDecoder).decode(e);if(this.status=2,this.answer+=t,this.answer.replace(/\r/g,"").endsWith("\n\n")){var r=this.answer.split(/\r?\n/);r.length>0&&""===r[r.length-1]&&(r=r.filter((function(e){return e})),this.status=3,this.resolve(r.join("\n")),this.finished(),this.status=4)}}}]),e}(),v=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(u.a)(this,e),this.status=1,this.id=void 0,this.serialPort=t,this.baudRate=r.baudRate||115200,this.queue=[],this.action=void 0,this.interCommandDelay=r.interCommandDelay,this.defaultCommandExpirationDelay=2e3,this.encoder=new TextEncoder,this.decoder=new TextDecoder}return Object(o.a)(e,[{key:"isReady",value:function(){return 2===this.status}},{key:"ensureProcessQueue",value:function(){var e=Object(s.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.currentProcessQueue||(this.currentProcessQueue=this.runProcessQueue()),e.abrupt("return",this.currentProcessQueue);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"runProcessQueue",value:function(){var e=Object(s.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.queue.length>0)){e.next=15;break}if(this.action=this.queue.shift(),!this.action){e.next=13;break}return this.action.start(),e.next=6,this.write("".concat(this.action.command,"\n"));case 6:return e.next=8,this.read(this.action);case 8:return e.next=10,this.action.finishedPromise;case 10:return this.action=void 0,e.next=13,f()(this.interCommandDelay);case 13:e.next=0;break;case 15:this.currentProcessQueue=void 0;case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getStatus",value:function(){var e=Object(s.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{value:this.status});case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"ensureOpen",value:function(){var e=Object(s.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(2===this.status){e.next=3;break}return e.abrupt("return",this.open());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"open",value:function(){var e=Object(s.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,this.serialPort.open({baudRate:this.baudRate});case 3:return this.reader=this.serialPort.readable.getReader(),this.writer=this.serialPort.writable.getWriter(),e.next=7,this.get("uq");case 7:this.id=e.sent,this.status=2;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(s.a)(i.a.mark((function e(t){var r,n,a,s,u=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>1&&void 0!==u[1]?u[1]:{},n=r.commandExpirationDelay,a=void 0===n?this.defaultCommandExpirationDelay:n,s=new d(t,{timeout:a}),this.queue.push(s),this.ensureProcessQueue(),e.abrupt("return",s.promise);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"error",value:function(e){"Error ".concat(this.port.path),this.status=10,this.emit("adapter",{event:"Error",value:e})}},{key:"close",value:function(){this.status=3}},{key:"write",value:function(){var e=Object(s.a)(i.a.mark((function e(t){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.encoder.encode("".concat(t,"\n")),e.abrupt("return",this.writer.write(r));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"read",value:function(){var e=Object(s.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isFinished()){e.next=9;break}return e.t0=t,e.next=4,this.reader.read();case 4:e.t1=e.sent.value,e.t0.appendAnswer.call(e.t0,e.t1),f()(10),e.next=0;break;case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function p(e){e||(console.error("Web serial doesn't seem to be enabled in your browser. Try enabling it by visiting:"),console.error("chrome://flags/#enable-experimental-web-platform-features"),console.error("opera://flags/#enable-experimental-web-platform-features"),console.error("edge://flags/#enable-experimental-web-platform-features"))}var m=function(e){Object(c.a)(r,e);var t=Object(l.a)(r);function r(e){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(u.a)(this,r),n=t.call(this),p(e),n.serial=e,n.devices=[],n.portFilter=void 0===a.portFilter?[{usbProductId:37384,usbVendorId:6991}]:a.portFilter,n.baudRate=a.baudRate||115200,n.interCommandDelay=void 0===a.interCommandDelay?100:a.interCommandDelay,n.defaultCommandExpirationDelay=void 0===a.defaultCommandExpirationDelay?100:a.defaultCommandExpirationDelay,n}return Object(o.a)(r,[{key:"requestDevices",value:function(){var e=Object(s.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.serial.requestPort({filters:this.portFilter});case 2:return e.abrupt("return",this.updateDevices());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateDevices",value:function(){var e=Object(s.a)(i.a.mark((function e(){var t,r,a,s,u,o,c,l,h=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.serial.getPorts();case 2:t=e.sent,r=this.devices.filter((function(e){return!t.includes(e.serialPort)})),a=Object(n.a)(r);try{for(a.s();!(s=a.n()).done;)9!==(u=s.value).status&&3!==u.status&&u.close(),u.status=9}catch(f){a.e(f)}finally{a.f()}o=Object(n.a)(t),e.prev=8,l=i.a.mark((function e(){var t,r,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=c.value,!(r=h.devices.filter((function(e){return e.serialPort===t}))[0])){e.next=7;break}return e.next=5,r.ensureOpen();case 5:e.next=11;break;case 7:return n=new v(t,{baudRate:h.baudRate,interCommandDelay:h.interCommandDelay,defaultCommandExpirationDelay:h.defaultCommandExpirationDelay}),h.devices.push(n),e.next=11,n.open();case 11:case"end":return e.stop()}}),e)})),o.s();case 11:if((c=o.n()).done){e.next=15;break}return e.delegateYield(l(),"t0",13);case 13:e.next=11;break;case 15:e.next=20;break;case 17:e.prev=17,e.t1=e.catch(8),o.e(e.t1);case 20:return e.prev=20,o.f(),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[8,17,20,23]])})));return function(){return e.apply(this,arguments)}}()},{key:"continuousUpdateDevices",value:function(){var e=Object(s.a)(i.a.mark((function e(){var t,r,n,a,s=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=s.length>0&&void 0!==s[0]?s[0]:{},r=t.scanInterval,n=void 0===r?1e3:r,a=t.callback;case 2:return e.next=5,this.updateDevices();case 5:return a&&a(this.devices),e.next=8,f()(n);case 8:e.next=2;break;case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getDevicesList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.ready,r=void 0!==t&&t;return this.devices.filter((function(e){return!r||e.isReady()})).map((function(e){return{status:e.status,id:e.id,queueLength:e.queue.length}}))}},{key:"findDevice",value:function(e){if(void 0!==e){var t=this.devices.filter((function(t){return t.id===e&&2===t.status}));if(0!==t.length){if(t.length>1)throw new Error("Many devices have the same id: ".concat(e));return t[0]}}}},{key:"sendCommand",value:function(){var e=Object(s.a)(i.a.mark((function e(t,r){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.findDevice(t)){e.next=3;break}throw Error("Device ".concat(t," not found"));case 3:if(!n||!n.isReady()){e.next=5;break}return e.abrupt("return",n.get(r));case 5:throw Error("Device ".concat(t," not ready: ").concat(n.port.path));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(function(){function e(){Object(u.a)(this,e),this.callbacks={}}return Object(o.a)(e,[{key:"on",value:function(e,t){this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t)}},{key:"emit",value:function(e,t){var r=this.callbacks[e];r&&r.forEach((function(e){return e(t)}))}}]),e}())},89:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(30);function a(e,t){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=Object(n.a)(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var a=0,i=function(){};return{s:i,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,u=!0,o=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return u=e.done,e},e:function(e){o=!0,s=e},f:function(){try{u||null==r.return||r.return()}finally{if(o)throw s}}}}}}]);
//# sourceMappingURL=9.7f716cb8.chunk.js.map