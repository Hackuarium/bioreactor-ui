(this["webpackJsonpbioreactor-ui"]=this["webpackJsonpbioreactor-ui"]||[]).push([[8],{110:function(e,t,n){"use strict";n.d(t,"d",(function(){return o})),n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return a})),n.d(t,"f",(function(){return s})),n.d(t,"e",(function(){return u})),n.d(t,"a",(function(){return l}));var r=n(120),c=n.n(r),o="BIOREACTOR_devices",i="80",a="http",s=["http","tcp","wss"],u=Object.keys(c.a).map((function(e){return c.a[e].kind})),l={compactSettings:"uc",runExperiment:"r",kinetic:"k",reset:"ur1234",sleep:"l",setParameter:function(e,t){return"".concat(e).concat(t)}}},121:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(4),c=n(20),o=n(0);function i(){var e=Object(c.L)(),t=function(t,n,c){var i=c.textColor,a=c.Icon,s=c.timeout;e.addNotification({title:Object(o.jsx)("span",{className:Object(r.a)("text-base font-semibold",i+"500"),children:t}),content:Object(o.jsx)("span",{className:"text-sm text-neutral-500",children:n}),icon:Object(o.jsx)(a,{className:Object(r.a)("w-8 h-8",i+"600")})},s)};return{addErrorNotification:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3;t(e,n,{textColor:"text-danger-",Icon:c.E,timeout:r})},addWarningNotification:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2500;t(e,n,{textColor:"text-warning-",Icon:c.E,timeout:r})},addInfoNotification:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;t(e,n,{textColor:"text-primary-",Icon:c.v,timeout:r})}}}},137:function(e,t,n){"use strict";n.d(t,"e",(function(){return O})),n.d(t,"d",(function(){return v})),n.d(t,"g",(function(){return w})),n.d(t,"c",(function(){return g})),n.d(t,"a",(function(){return N})),n.d(t,"b",(function(){return k})),n.d(t,"f",(function(){return y}));var r,c=n(1),o=n(53),i=n.n(o),a=n(59),s=n(156),u=function(e){var t=function(){return new s.a(e)};return{getInfo:function(){return new Promise((function(e,n){var r=t();r.info().then((function(t){return r.close((function(){return e(t)}))})).catch((function(e){return r.close((function(){return n(e)}))}))}))},getAll:function(){var e=Object(a.a)(i.a.mark((function e(n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var o=t();o.allDocs(Object(c.a)({include_docs:!0},n)).then((function(t){return o.close((function(){return e(t)}))})).catch((function(e){return o.close((function(){return r(e)}))}))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),get:function(e){return new Promise((function(n,r){var c=t();e?c.get(e).then((function(e){return c.close((function(){return n(e)}))})).catch((function(e){return c.close((function(){return r(e)}))})):r(new Error("Doc fetch : docId is required"))}))},put:function(e){return new Promise((function(n,r){var c=t();"_id"in e?c.put(e).then((function(e){return c.close((function(){return n(e)}))})).catch((function(e){return c.close((function(){return r(e)}))})):r(new Error("Doc create : _id is required in doc"))}))},update:function(e){return new Promise((function(n,r){var o=t();"_id"in e?o.get(e._id).then((function(t){return o.put(Object(c.a)(Object(c.a)({},e),{},{_rev:t._rev})).then((function(e){return o.close((function(){return n(e)}))})).catch((function(e){return r(e)}))})).catch((function(e){return o.close((function(){return r(e)}))})):r(new Error("Doc update : _id is required in doc"))}))},remove:function(e){return new Promise((function(n,r){var c=t();e?c.get(e).then((function(t){return c.remove({_id:e,_rev:t._rev}).then((function(e){return c.close((function(){return n(e)}))})).catch((function(e){return r(e)}))})).catch((function(e){return c.close((function(){return r(e)}))})):r(new Error("Doc remove : docId is required"))}))}}},l=n(112),d=n(158),f=n.n(d),m=n(144),b=function(e,t,n,c,o){return new Promise((function(c,o){!function(e,t,n,c,o,i,a){r&&r.connected&&r.options.hostname===e&&Object(l.isFunction)(i)&&i(r);var s="".concat(t,"://").concat(e,":").concat(n);(r=f.a.connect(s,{keepalive:300,reconnectPeriod:5e3})).on("connect",(function(){console.log("connected to ".concat(s," : ").concat(r.connected)),Object(l.isFunction)(i)&&i(r)})),r.stream.on("error",(function(e){console.log(e);var t=new Error("Couldn't connect to BROKER \"".concat(s,'"'));t.name="Mqtt Error",r.end(),Object(l.isFunction)(a)&&a(t)}))}(e,t,n,0,0,(function(e){return c(e)}),(function(e){return o(e)}))}))},j=function(e,t,n,r){e.subscribe(t,{qos:2},(function(t){t?Object(l.isFunction)(r)&&r(t):e.on("message",(function(e,t){var r;Object(l.isFunction)(n)&&n((r=t,Object(m.parseCurrentSettings)(r.toString(),{})))}))}));return function(n){return e.unsubscribe(t,{},n)}},p=function(e,t){return e.end((function(){console.log('mqtt broker "'.concat(e.options.hostname,'" disconnected')),Object(l.isFunction)(t)&&t()}))},x=n(110),h=function(e,t){console.log(e);var n=new Error("".concat(t," \n").concat(null===e||void 0===e?void 0:e.message));throw n.name="DATABASE_ERROR",n},O=function(){var e=Object(a.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",u(x.d).getAll().then((function(e){return e.rows.map((function(e){return e.doc}))})).catch((function(e){return h(e,"Get locally saved devices error")})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),v=function(){var e=Object(a.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",u(x.d).get(t).catch((function(e){return h(e,"Get device error")})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w=function(){var e=Object(a.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",u(x.d).update(t).catch((function(e){return h(e,"Update device error")})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=function(e){return u(x.d).remove(e).catch((function(e){return h(e,"Delete device error")}))},N=function(e){var t=e.kind,n=e.name,r=e.url,c=e.protocol,o=void 0===c?x.c:c,i=e.port,a=void 0===i?x.b:i,s=e.topic,l=e.username,d=e.password;return u(x.d).put({_id:"".concat(t,"_").concat(n),name:n,url:r,protocol:o,port:a,topic:s,kind:t,username:l,password:d}).catch((function(e){return"conflict"===e.name?h(e,"Device name must be unique"):h(e,"Insert device error")}))},k=function(e){var t=e._id,n=e.name,r=e.kind,o=e.deviceId,s=void 0===o?t||"".concat(r,"_").concat(n):o,d=e.url,f=e.protocol,m=void 0===f?x.c:f,h=e.port,O=void 0===h?x.b:h,v=e.topic;e.username,e.password;return new Promise(function(){var e=Object(a.a)(i.a.mark((function e(t,n){var r,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b(d,m,O);case 3:r=e.sent,o=u(s),t({subscribe:function(e,t){return j(r,v,(function(t){o.put(Object(c.a)({_id:Date.now().toString()},t)),Object(l.isFunction)(e)&&e(t)}),t)},disconnect:function(){return p(r)},getAllData:function(){return o.getAll().then((function(e){return e.rows.map((function(e){return e.doc}))}))},getLastData:function(){return o.getAll({descending:!0,limit:1}).then((function(e){return e.rows.map((function(e){return e.doc}))}))},getPageData:function(e,t){return o.getAll({descending:!0,skip:e,limit:t}).then((function(e){return e.rows.map((function(e){return e.doc}))}))},getAllDataCount:function(){return o.getAll().then((function(e){return e.total_rows}))}}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),n(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t,n){return e.apply(this,arguments)}}())},y=function(e){var t=e.url,n=e.protocol,r=void 0===n?x.c:n,c=e.port,o=void 0===c?x.b:c,s=e.topic;e.username,e.password;return new Promise(function(){var e=Object(a.a)(i.a.mark((function e(n,c){var a,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b(t,r,o);case 3:a=e.sent,u=j(a,s,(function(e){u(),p(a,(function(){return n(e)}))}),c),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),c(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}())}},157:function(e,t){},162:function(e,t){},163:function(e,t){},175:function(e,t){},176:function(e,t){},403:function(e,t,n){"use strict";n.r(t);var r=n(53),c=n.n(r),o=n(59),i=n(6),a=n(2),s=n(112),u=n(20),l=n(137),d=n(121),f=n(0),m=function(e){var t=e.data,n=e.onSelect,r=e.onEdit,l=e.onDelete,d=Object(a.useState)(),m=Object(i.a)(d,2),b=m[0],j=m[1],p=function(){var e=Object(o.a)(c.a.mark((function e(t,r){var o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:b||(j(t),o=function(){return j(null)},Object(s.isFunction)(n)&&n(t,r,o));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return Object(f.jsx)("div",{className:"overflow-hidden bg-white shadow sm:rounded-md",children:t.map((function(e){return Object(f.jsxs)("li",{className:"block transition duration-150 ease-in-out hover:bg-gray-50 focus:outline-none focus:bg-gray-50 cursor-pointer",onClick:function(t){return p(e,t)},children:[Object(f.jsxs)("div",{className:"relative flex items-center px-4 py-4 sm:px-6",children:[b===e&&Object(f.jsx)("div",{className:"absolute top-0 left-0 w-full h-full opacity-30 bg-neutral-300",children:Object(f.jsx)("div",{className:"w-full h-full flex justify-center items-center",children:Object(f.jsx)(u.l,{className:"w-8 h-8 text-primary-800"})})}),Object(f.jsx)("div",{className:"flex items-center flex-1 min-w-0",children:Object(f.jsxs)("div",{className:"flex-1 min-w-0 px-4 sm:grid sm:grid-col-2 sm:gap-4",children:[Object(f.jsx)("p",{className:"col-span-2 text-lg font-semibold truncate text-primary-700",children:e.name}),Object(f.jsxs)("div",{className:"flex flex-col text-xs font-italic text-neutral-600",children:[Object(f.jsxs)("p",{className:"truncate",children:[Object(f.jsx)("span",{className:"font-semibold",children:"Device kind : "}),e.kind]}),Object(f.jsxs)("p",{className:"truncate",children:[Object(f.jsx)("span",{className:"font-semibold",children:"URL : "}),"".concat(e.protocol,"://").concat(e.url,":").concat(e.port)]}),Object(f.jsxs)("p",{className:"truncate",children:[Object(f.jsx)("span",{className:"font-semibold",children:"Topic : "}),e.topic]})]}),Object(f.jsxs)("div",{className:"pt-2 sm:pt-0 flex justify-end items-center cursor-default",children:[Object(f.jsx)("button",{className:"mx-1 p-2 border rounded shadow-sm bg-neutral-100 focus:outline-none active:bg-neutral-200",onClick:function(t){return r(e,t)},children:Object(f.jsx)(u.D,{className:"text-gray-700"})}),Object(f.jsx)("button",{className:"mx-1 p-2 border rounded shadow-sm bg-neutral-100 focus:outline-none active:bg-neutral-200",onClick:function(t){return l(e,t)},children:Object(f.jsx)(u.F,{className:"text-gray-700"})})]})]})}),Object(f.jsx)("div",{children:Object(f.jsx)(u.q,{className:"w-5 h-5 text-neutral-400"})})]}),Object(f.jsx)("div",{className:"w-full border-t border-neutral-100"})]},e.kind+e.name)}))})},b=n(1),j=n(392),p=n(110),x=p.f.map((function(e){return{label:e.toUpperCase(),value:e}})),h=p.e.map((function(e){return{label:e,value:e}})),O=j.b().shape({name:j.c().max(50,"Name too Long!").matches(/^[A-z0-9_-]*$/,"Field supports only : letters / numbers / _ / - ").required("Required"),url:j.c().required("Required"),port:j.a().positive().integer(),protocol:j.c(),kind:j.c().required("Required"),topic:j.c().required("Required"),username:j.c().required("Required")}),v=function(e){var t=e.isOpen,n=e.onClose,r=e.onSave,d=e.onUpdate,m=e.initialValues,j=!Object(s.isEmpty)(m),v=Object(a.useState)(Object(f.jsx)("div",{})),w=Object(i.a)(v,2),g=w[0],N=w[1],k=Object(a.useRef)(null),y=Object(b.a)({name:"Computer",url:"mqtt.hackuarium.org",protocol:x[0].value,port:p.b,kind:h[0].value,topic:"lpatiny/Computer/server",username:"testUser",password:"word"},m);Object(a.useEffect)((function(){!t&&setTimeout((function(){return N(Object(f.jsx)("div",{}))}),500)}),[t]);var C=function(){var e=Object(o.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!j){e.next=8;break}if(e.t0=Object(s.isFunction)(d),!e.t0){e.next=6;break}return e.next=6,d(t);case 6:e.next=12;break;case 8:if(e.t1=Object(s.isFunction)(r),!e.t1){e.next=12;break}return e.next=12,r(t);case 12:Object(s.isFunction)(n)&&n(),e.next=18;break;case 15:throw e.prev=15,e.t2=e.catch(0),new Error(e.t2.message);case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t){return e.apply(this,arguments)}}(),q=function(e,t){switch(e){case"connecting":N(Object(f.jsxs)("div",{className:"mx-6 flex flex-row items-center text-sm text-left text-neutral-500",children:[Object(f.jsx)(u.l,{className:"w-6 h-6 mr-2"}),Object(f.jsx)("span",{children:t})]}));break;case"success":N(Object(f.jsxs)("div",{className:"mx-4 flex flex-row items-center text-sm text-left text-success-500",children:[Object(f.jsx)(u.p,{className:"h-6 w-6 mr-4"}),Object(f.jsx)("span",{children:t})]}));break;case"error":N(Object(f.jsxs)("div",{className:"mx-4 flex flex-row items-center text-sm text-left text-danger-500",children:[Object(f.jsx)(u.C,{className:"h-6 w-6 mr-4"}),Object(f.jsx)("span",{children:t})]}));break;default:N(Object(f.jsx)("div",{}))}};return Object(f.jsxs)(u.h,{isOpen:t,onRequestClose:n,icon:Object(f.jsx)(u.z,{}),iconColor:"neutral",animated:!0,hasCloseButton:!0,requestCloseOnBackdrop:!0,requestCloseOnEsc:!0,fluid:!0,wrapperComponent:u.d,wrapperProps:{innerRef:k,initialValues:y,validationSchema:O,onSubmit:C,className:"h-full"},children:[Object(f.jsx)(u.h.Header,{children:"Connect New Device"}),Object(f.jsxs)(u.h.Body,{children:[Object(f.jsxs)("div",{className:"p-2 mt-2",children:[Object(f.jsx)(u.g,{name:"name",id:"name",label:"Custom name",placeholder:"Device name",disabled:j,required:!0,className:"w-full",inputClassName:"w-full"}),Object(f.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between mt-4 sm:mt-0 border-t border-neutral sm:border-0",children:[Object(f.jsx)(u.g,{name:"url",id:"url",label:"URL",placeholder:"mqtt.domain.com",required:!0,leadingInlineAddon:Object(f.jsx)(u.x,{}),className:"mt-4 sm:mr-4 w-full sm:w-1/2",inputClassName:"w-full"}),Object(f.jsxs)("div",{className:"flex flex-row justify-between items-start flex-1",children:[Object(f.jsx)(u.k,{name:"protocol",id:"protocol",label:"Protocol",options:x,renderOption:function(e){return"".concat(e.label)},getValue:function(e){return e.value},className:"mt-4 mr-4 w-1/2",inputClassName:"w-full"}),Object(f.jsx)(u.g,{name:"port",id:"port",label:"Port",className:"mt-4 flex-1",inputClassName:"w-full"})]})]}),Object(f.jsxs)("div",{className:"flex flex-row justify-between items-start",children:[Object(f.jsx)(u.k,{name:"kind",id:"kind",label:"Device kind",options:h,renderOption:function(e){return"".concat(e.label)},getValue:function(e){return e.value},required:!0,className:"mt-4 mr-4 w-1/3 ",inputClassName:"w-full bg-gray-500"}),Object(f.jsx)(u.g,{name:"topic",id:"topic",label:"Topic",required:!0,className:"mt-4 flex-1",inputClassName:"w-full"})]}),Object(f.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between mt-4 sm:mt-0 border-t border-neutral sm:border-0",children:[Object(f.jsx)(u.g,{name:"username",id:"username",label:"Username",placeholder:"Username",required:!0,leadingInlineAddon:Object(f.jsx)(u.B,{}),className:"mt-4 w-full sm:mr-4 sm:w-1/2",inputClassName:"w-full"}),Object(f.jsx)(u.g,{name:"password",id:"password",label:"Password",type:"password",placeholder:"********",required:!0,leadingInlineAddon:Object(f.jsx)(u.w,{}),className:"mt-4 w-full sm:flex-1",inputClassName:"w-full"})]})]}),Object(f.jsx)(u.e,{})]}),Object(f.jsx)(u.h.Footer,{children:Object(f.jsxs)("div",{className:"flex flex-col sm:flex-row items-center",children:[g,Object(f.jsx)("button",{onClick:function(e){e.stopPropagation(),q("connecting","Connecting ..."),setTimeout((function(){Object(l.f)(k.current.values).then((function(){q("success","Connected")})).catch((function(e){q("error","Connection Error: ".concat(e.message))}))}),500)},type:"button",className:"w-full sm:w-max mt-2 sm:my-0 px-4 py-2 sm:mr-4 text-sm font-semibold text-neutral-700 border rounded-md shadow bg-neutral-200 focus:outline-none flex-1 sm:flex-none",children:"Test connection"}),Object(f.jsx)(u.m,{className:"w-full my-2 sm:my-0 sm:w-max ",children:j?"Update":"Add"})]})})]})};t.default=function(e){var t=e.history,n=e.match,r=Object(a.useState)(!1),b=Object(i.a)(r,2),j=b[0],p=b[1],x=Object(a.useState)(!1),h=Object(i.a)(x,2),O=h[0],w=h[1],g=Object(a.useState)([]),N=Object(i.a)(g,2),k=N[0],y=N[1],C=Object(a.useState)({}),q=Object(i.a)(C,2),E=q[0],_=q[1],D=Object(d.a)().addErrorNotification;Object(a.useEffect)((function(){Object(l.e)().then((function(e){return y(e)}))}),[j]);return Object(f.jsxs)("div",{className:"p-8",children:[Object(f.jsx)("h2",{className:"text-3xl font-semibold mb-10",children:"Broadcast devices"}),Object(f.jsx)("div",{className:"w-full flex justify-end mb-4",children:Object(f.jsx)(u.a,{onClick:function(){_({}),w(!0)},children:"Add device"})}),Object(f.jsxs)("div",{children:[Object(f.jsxs)("div",{className:"w-full my-2 flex flex-row items-center ",children:[Object(f.jsx)("h3",{className:"w-max ml-2 mr-4 text-neutral-600 text-sm whitespace-nowrap ",children:"Available devices"}),Object(f.jsx)("div",{className:"w-full border-t border-neutral-300"})]}),Object(f.jsx)(m,{data:k,onSelect:function(e,r,i){setTimeout(Object(o.a)(c.a.mark((function o(){return c.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:Object(l.f)(e).then((function(){Object(s.isFunction)(i)&&i(),t.push(n.url+"/device/"+e._id)})).catch((function(e){D(r.name,r.message),Object(s.isFunction)(i)&&i()}));case 1:case"end":return c.stop()}}),o)}))),500)},onEdit:function(e,t){t.stopPropagation(),_(e),w(!0)},onDelete:function(e,t){t.stopPropagation(),Object(l.c)(e._id).then((function(){return p(!j)})).catch((function(e){return D(e.name,e.message)}))}})]}),Object(f.jsx)(v,{isOpen:O,onClose:function(){p(!j),w(!1)},initialValues:E,onSave:l.a,onUpdate:l.g})]})}}}]);
//# sourceMappingURL=8.fa33a1e2.chunk.js.map