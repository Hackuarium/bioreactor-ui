(this["webpackJsonpbioreactor-ui"]=this["webpackJsonpbioreactor-ui"]||[]).push([[5],{100:function(e,t,n){"use strict";n.d(t,"c",(function(){return c})),n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return s})),n.d(t,"e",(function(){return a})),n.d(t,"d",(function(){return o}));var c="BIOREACTOR_devices",r="9001",s="tcp",a=["tcp","http"],o=["computer","beemos","openBio","openBio6","openSpectro","simpleSpectro","solar2015"]},117:function(e,t,n){"use strict";n.d(t,"e",(function(){return x})),n.d(t,"d",(function(){return O})),n.d(t,"f",(function(){return h})),n.d(t,"c",(function(){return v})),n.d(t,"a",(function(){return w})),n.d(t,"b",(function(){return g}));var c=n(1),r=n(35),s=n.n(r),a=n(45),o=n(157),i=n(91);var u,l=function(){var e=null,t={};return{connect:function(n){(!e||t&&t.db_name!==n)&&((e=new o.a(n)).info().then((function(e){return t=e})),console.log('connected to DB "'.concat(n,'"')));return{getInfo:function(){return t},put:function(t){return"_id"in t?e.put(t):Promise.reject(new Error("doc must include _id"))},get:function(t){return e.get(t)},getAll:function(){var t=Object(a.a)(s.a.mark((function t(n){var r;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.allDocs(Object(c.a)({include_docs:!0},n));case 2:return r=t.sent,t.abrupt("return",r.rows);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),update:function(t){return"_id"in t?e.get(t._id).then((function(n){return e.put(Object(c.a)(Object(c.a)({},t),{},{_rev:n._rev}))})):Promise.reject(new Error("doc must include _id"))},remove:function(t){return e.get(t).then((function(n){return e.remove({_id:t,_rev:n._rev})}))},removeAll:function(){return e.destroy().then((function(t){e=null,console.log('DB "'.concat(n,'" destroyed : ')+JSON.stringify(t))}))},close:function(t){return e.close((function(){e=null,console.log('DB "'.concat(n,'" closed')),Object(i.isFunction)(t)&&t()}))}}}}}(),d=n(159),m=n.n(d),f=n(190),b=n(100),j=function(e,t,n,c,r){return new Promise((function(s,a){!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b.b,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b.a,c=arguments.length>5?arguments[5]:void 0,r=arguments.length>6?arguments[6]:void 0;u&&u.connected&&u.options.hostname===e&&Object(i.isFunction)(c)&&c(u);var s="".concat(t,"://").concat(e,":").concat(n);(u=m.a.connect(s,{keepalive:300,reconnectPeriod:5e3})).on("connect",(function(){console.log("connected to ".concat(s," : ").concat(u.connected)),Object(i.isFunction)(c)&&c(u)})),u.stream.on("error",(function(e){console.log(e);var t=new Error("Couldn't connect to BROKER \"".concat(s,'"'));t.name="Mqtt Error",u.end(),Object(i.isFunction)(r)&&r(t)}))}(e,t,n,c,r,(function(e){return s(e)}),(function(e){return a(e)}))}))},p=function(e,t,n,c){e.subscribe(t,{qos:2},(function(t){t?Object(i.isFunction)(c)&&c(t):e.on("message",(function(e,t){var c;Object(i.isFunction)(n)&&n((c=t,Object(f.parseCurrentSettings)(c.toString(),{})))}))}));return function(n){return e.unsubscribe(t,{},n)}},x=function(){var e=Object(a.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l.connect(b.c),e.next=3,t.getAll();case 3:return n=e.sent,e.abrupt("return",n.map((function(e){return e.doc})));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),O=function(){var e=Object(a.a)(s.a.mark((function e(t){var n,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.connect(b.c),e.next=3,n.get(t);case 3:return c=e.sent,e.abrupt("return",c);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),h=function(){var e=Object(a.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.connect(b.c),e.abrupt("return",n.update(t));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=function(e){return l.connect(b.c).remove(e).catch((function(e){var t=new Error("Couldn't remove record: ".concat(e.message));throw t.name="Database Error",t}))},w=function(e){var t=l.connect(b.c),n=e.kind,c=e.name,r=e.url,s=e.protocol,a=e.port,o=e.topic,i=e.username,u=e.password;for(var d in e)if(!e[d])throw new Error("Field missing [".concat(d,"]"));var m="".concat(n,"_").concat(c);return t.get(m).then((function(e){var t=new Error("Another device exists with the same name");throw t.payload={exist:!0,payload:e},t})).catch((function(e){if(e.payload&&e.payload.exist)throw e;return t.put({_id:m,name:c,url:r,protocol:s,port:a,topic:o,kind:n,username:i,password:u}).then((function(e){return{exist:!1,inserted:!0,payload:e}})).catch((function(e){var t=new Error(e.toString());throw t.payload={exist:!1,inserted:!1,payload:e.toString()},t}))}))},g=function(e){var t=e._id,n=e.name,r=e.kind,o=e.deviceId,u=void 0===o?t||"".concat(r,"_").concat(n):o,d=e.url,m=e.protocol,f=e.port,b=e.topic,x=e.username,O=e.password;return new Promise(function(){var e=Object(a.a)(s.a.mark((function e(t,n){var r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j(d,m,f,x,O);case 3:r=e.sent,a=l.connect(u),t({subscribe:function(e,t){return p(r,b,(function(t){a.put(Object(c.a)({_id:Date.now().toString()},t)),Object(i.isFunction)(e)&&e(t)}),t)},disconnect:function(){return t=function(){return a.close()},(e=r).end((function(){console.log('mqtt broker "'.concat(e.options.hostname,'" disconnected')),Object(i.isFunction)(t)&&t()}));var e,t},getAllData:function(){return a.getAll()},getLastData:function(){return a.getAll({descending:!0,limit:1})}}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),n(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n){return e.apply(this,arguments)}}())}},158:function(e,t){},164:function(e,t){},165:function(e,t){},178:function(e,t){},179:function(e,t){},183:function(e,t){},184:function(e,t){},381:function(e,t,n){"use strict";n.r(t);var c=n(35),r=n.n(c),s=n(45),a=n(6),o=n(3),i=n(91),u=n(15),l=n(0),d=function(e){var t=e.data,n=e.onSelect,c=e.onEdit,d=e.onDelete,m=Object(o.useState)(),f=Object(a.a)(m,2),b=f[0],j=f[1],p=function(){var e=Object(s.a)(r.a.mark((function e(t,c){var s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:b||(j(t),s=function(){return j(null)},Object(i.isFunction)(n)&&n(t,c,s));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return Object(l.jsx)("div",{className:"overflow-hidden bg-white shadow sm:rounded-md",children:t.map((function(e){return Object(l.jsxs)("li",{className:"block transition duration-150 ease-in-out hover:bg-gray-50 focus:outline-none focus:bg-gray-50 cursor-pointer",onClick:function(t){return p(e,t)},children:[Object(l.jsxs)("div",{className:"relative flex items-center px-4 py-4 sm:px-6",children:[b===e&&Object(l.jsx)("div",{className:"absolute top-0 left-0 w-full h-full opacity-30 bg-neutral-300",children:Object(l.jsx)("div",{className:"w-full h-full flex justify-center items-center",children:Object(l.jsx)(u.i,{className:"w-8 h-8 text-primary-800"})})}),Object(l.jsx)("div",{className:"flex items-center flex-1 min-w-0",children:Object(l.jsxs)("div",{className:"flex-1 min-w-0 px-4 sm:grid sm:grid-col-2 sm:gap-4",children:[Object(l.jsx)("p",{className:"col-span-2 text-lg font-semibold truncate text-primary-700",children:e.name}),Object(l.jsxs)("div",{className:"flex flex-col text-xs font-italic text-neutral-600",children:[Object(l.jsxs)("p",{className:"truncate",children:[Object(l.jsx)("span",{className:"font-semibold",children:"Device kind : "}),e.kind]}),Object(l.jsxs)("p",{className:"truncate",children:[Object(l.jsx)("span",{className:"font-semibold",children:"URL : "}),"".concat(e.protocol,"://").concat(e.url,":").concat(e.port)]}),Object(l.jsxs)("p",{className:"truncate",children:[Object(l.jsx)("span",{className:"font-semibold",children:"Topic : "}),e.topic]})]}),Object(l.jsxs)("div",{className:"pt-2 sm:pt-0 flex justify-end items-center cursor-default",children:[Object(l.jsx)("button",{className:"mx-1 p-2 border rounded shadow-sm bg-neutral-100 focus:outline-none active:bg-neutral-200",onClick:function(t){return c(e,t)},children:Object(l.jsx)(u.A,{className:"text-gray-700"})}),Object(l.jsx)("button",{className:"mx-1 p-2 border rounded shadow-sm bg-neutral-100 focus:outline-none active:bg-neutral-200",onClick:function(t){return d(e,t)},children:Object(l.jsx)(u.C,{className:"text-gray-700"})})]})]})}),Object(l.jsx)("div",{children:Object(l.jsx)(u.n,{className:"w-5 h-5 text-neutral-400"})})]}),Object(l.jsx)("div",{className:"w-full border-t border-neutral-100"})]},e.kind+e.name)}))})},m=n(1),f=n(368),b=n(117),j=n(100),p=j.e.map((function(e){return{label:e.toUpperCase(),value:e}})),x=j.d.map((function(e){return{label:e,value:e}})),O=f.b().shape({name:f.c().max(50,"Name too Long!").matches(/^[A-z0-9_-]*$/,"Field supports only : letters / numbers / _ / - ").required("Required"),url:f.c().required("Required"),port:f.a().positive().integer(),protocol:f.c(),kind:f.c().required("Required"),topic:f.c().required("Required"),username:f.c().required("Required")}),h=function(e){var t=e.isOpen,n=e.onClose,c=e.onSave,d=e.onUpdate,f=e.initialValues,j=!Object(i.isEmpty)(f),h=Object(o.useState)(Object(l.jsx)("div",{})),v=Object(a.a)(h,2),w=v[0],g=v[1],N=Object(o.useRef)(null),y=Object(m.a)({name:"123",url:"mqtt.beemos.org",protocol:p[0].value,port:"9001",kind:x[0].value,topic:"lpatiny/Computer/server",username:"testUser",password:"word"},f),k=function(){var e=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!j){e.next=8;break}if(e.t0=Object(i.isFunction)(d),!e.t0){e.next=6;break}return e.next=6,d(t);case 6:e.next=12;break;case 8:if(e.t1=Object(i.isFunction)(c),!e.t1){e.next=12;break}return e.next=12,c(t);case 12:Object(i.isFunction)(n)&&n(),e.next=18;break;case 15:throw e.prev=15,e.t2=e.catch(0),new Error(e.t2.message);case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t){return e.apply(this,arguments)}}();Object(o.useEffect)((function(){!t&&setTimeout((function(){return g(Object(l.jsx)("div",{}))}),500)}),[t]);var C=function(e,t){switch(e){case"connecting":return Object(l.jsxs)("div",{className:"mx-6 flex flex-row items-center text-sm text-left text-neutral-500",children:[Object(l.jsx)(u.i,{className:"w-6 h-6 mr-2"}),Object(l.jsx)("span",{children:t})]});case"success":return Object(l.jsxs)("div",{className:"mx-4 flex flex-row items-center text-sm text-left text-success-500",children:[Object(l.jsx)(u.m,{className:"h-6 w-6 mr-4"}),Object(l.jsx)("span",{children:t})]});case"error":return Object(l.jsxs)("div",{className:"mx-4 flex flex-row items-center text-sm text-left text-danger-500",children:[Object(l.jsx)(u.z,{className:"h-6 w-6 mr-4"}),Object(l.jsx)("span",{children:t})]});default:return Object(l.jsx)("div",{})}};return Object(l.jsxs)(u.e,{isOpen:t,onRequestClose:n,icon:Object(l.jsx)(u.w,{}),iconColor:"neutral",animated:!0,hasCloseButton:!0,requestCloseOnBackdrop:!0,requestCloseOnEsc:!0,fluid:!0,wrapperComponent:u.b,wrapperProps:{innerRef:N,initialValues:y,validationSchema:O,onSubmit:k,className:"h-full"},children:[Object(l.jsx)(u.e.Header,{children:"Connect New Device"}),Object(l.jsxs)(u.e.Body,{children:[Object(l.jsxs)("div",{className:"p-2 mt-2",children:[Object(l.jsx)(u.d,{name:"name",id:"name",label:"Custom name",placeholder:"device_123",disabled:j,required:!0,className:"w-full",inputClassName:"w-full"}),Object(l.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between mt-4 sm:mt-0 border-t border-neutral sm:border-0",children:[Object(l.jsx)(u.d,{name:"url",id:"url",label:"URL",placeholder:"mqtt.domain.com",required:!0,leadingInlineAddon:Object(l.jsx)(u.u,{}),className:"mt-4 sm:mr-4 w-full sm:w-1/2",inputClassName:"w-full"}),Object(l.jsxs)("div",{className:"flex flex-row justify-between items-start flex-1",children:[Object(l.jsx)(u.h,{name:"protocol",id:"protocol",label:"Protocol",options:p,renderOption:function(e){return"".concat(e.label)},getValue:function(e){return e.value},className:"mt-4 mr-4 w-1/2",inputClassName:"w-full"}),Object(l.jsx)(u.d,{name:"port",id:"port",label:"Port",className:"mt-4 flex-1",inputClassName:"w-full"})]})]}),Object(l.jsxs)("div",{className:"flex flex-row justify-between items-start",children:[Object(l.jsx)(u.h,{name:"kind",id:"kind",label:"Device kind",options:x,renderOption:function(e){return"".concat(e.label)},getValue:function(e){return e.value},required:!0,className:"mt-4 mr-4 w-1/3 ",inputClassName:"w-full bg-gray-500"}),Object(l.jsx)(u.d,{name:"topic",id:"topic",label:"Topic",required:!0,className:"mt-4 flex-1",inputClassName:"w-full"})]}),Object(l.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between mt-4 sm:mt-0 border-t border-neutral sm:border-0",children:[Object(l.jsx)(u.d,{name:"username",id:"username",label:"Username",placeholder:"Username",required:!0,leadingInlineAddon:Object(l.jsx)(u.y,{}),className:"mt-4 w-full sm:mr-4 sm:w-1/2",inputClassName:"w-full"}),Object(l.jsx)(u.d,{name:"password",id:"password",label:"Password",type:"password",placeholder:"********",required:!0,leadingInlineAddon:Object(l.jsx)(u.t,{}),className:"mt-4 w-full sm:flex-1",inputClassName:"w-full"})]})]}),Object(l.jsx)(u.c,{})]}),Object(l.jsx)(u.e.Footer,{children:Object(l.jsxs)("div",{className:"flex flex-col sm:flex-row items-center",children:[w,Object(l.jsx)("button",{onClick:function(e){e.stopPropagation(),g(C("connecting","Connecting ...")),setTimeout((function(){Object(b.b)(N.current.values).then((function(e){g(C("success","Connected"))})).catch((function(e){g(C("error","Connection Error: ".concat(e.message)))}))}),500)},type:"button",className:"w-full sm:w-max mt-2 sm:my-0 px-4 py-2 sm:mr-4 text-sm font-semibold text-neutral-700 border rounded-md shadow bg-neutral-200 focus:outline-none flex-1 sm:flex-none",children:"Test connection"}),Object(l.jsx)(u.j,{className:"w-full my-2 sm:my-0 sm:w-max ",children:j?"Update":"Add"})]})})]})};t.default=function(e){var t=e.history,n=e.match,c=Object(o.useState)(!1),m=Object(a.a)(c,2),f=m[0],j=m[1],p=Object(o.useState)(!1),x=Object(a.a)(p,2),O=x[0],v=x[1],w=Object(o.useState)([]),g=Object(a.a)(w,2),N=g[0],y=g[1],k=Object(o.useState)({}),C=Object(a.a)(k,2),q=C[0],_=C[1],E=function(){var e=Object(u.G)();return{addErrorNotification:function(t,n){e.addNotification({title:Object(l.jsx)("span",{className:" text-base font-semibold text-danger-500",children:t}),content:Object(l.jsx)("span",{className:"text-sm text-neutral-500",children:n}),icon:Object(l.jsx)(u.B,{className:"w-8 h-8 text-danger-600"})},4e3)},addInfoNotification:function(t,n){e.addNotification({title:Object(l.jsx)("span",{className:"text-base font-semibold text-primary-500",children:t}),content:Object(l.jsx)("span",{className:"text-sm text-neutral-500",children:n}),icon:Object(l.jsx)(u.s,{className:"w-8 h-8 text-primary-600"})},4e3)}}}().addErrorNotification;Object(o.useEffect)((function(){Object(b.e)().then((function(e){return y(e)}))}),[f]);return Object(l.jsxs)("div",{className:"p-8",children:[Object(l.jsx)("h2",{className:"text-3xl font-semibold mb-12 lg:mb-16",children:"Broadcast devices"}),Object(l.jsx)("div",{className:"w-full flex justify-end mb-6 lg:mb-8",children:Object(l.jsx)(u.a,{onClick:function(){_({}),v(!0)},children:"Add device"})}),Object(l.jsxs)("div",{children:[Object(l.jsxs)("div",{className:"w-full my-2 flex flex-row items-center ",children:[Object(l.jsx)("h3",{className:"w-max ml-2 mr-4 text-neutral-600 text-sm whitespace-nowrap ",children:"Available devices"}),Object(l.jsx)("div",{className:"w-full border-t border-neutral-300"})]}),Object(l.jsx)(d,{data:N,onSelect:function(e,c,a){setTimeout(Object(s.a)(r.a.mark((function c(){return r.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,c.next=3,Object(b.b)(e);case 3:Object(i.isFunction)(a)&&a(),t.push(n.url+"/device/"+e._id),c.next=11;break;case 7:c.prev=7,c.t0=c.catch(0),E(c.t0.name,c.t0.message),Object(i.isFunction)(a)&&a();case 11:case"end":return c.stop()}}),c,null,[[0,7]])}))),500)},onEdit:function(e,t){t.stopPropagation(),_(e),v(!0)},onDelete:function(e,t){t.stopPropagation(),Object(b.c)(e._id).then((function(){return j(!f)})).catch((function(e){return E(e.name,e.message)}))}})]}),Object(l.jsx)(h,{isOpen:O,onClose:function(){j(!f),v(!1)},initialValues:q,onSave:b.a,onUpdate:b.f})]})}}}]);
//# sourceMappingURL=5.21f41a08.chunk.js.map