{"version":3,"sources":["services/devicesOptions.js","hooks/useNotification.js","services/mqttService.js","services/db.js","services/broadCastDeviceService.js","pages/BroadcastDevices/DevicesList.jsx","pages/BroadcastDevices/DeviceModal.jsx","pages/BroadcastDevices/index.jsx"],"names":["DEVICES_DB","DEFAULT_PORT","window","location","protocol","DEFAULT_PROTOCOL","DEVICE_PROTOCOLS","COMMANDS","help","settings","compactSettings","runExperiment","kinetic","reset","sleep","setParameter","label","value","DEVICE_KINDS_OPTIONS","Object","keys","legoinoDeviceInformation","map","key","kind","filter","type","getDeviceType","deviceId","selectedDeviceType","fromDeviceID","Number","element","id","e","console","log","useNotification","notificationContext","useNotificationCenter","addNotification","title","message","textColor","Icon","timeout","className","clsx","content","icon","addErrorNotification","SvgSolidExclamation","addWarningNotification","addInfoNotification","SvgOutlineExclamationCircle","client","DB","dbName","connect","PouchDB","getInfo","Promise","resolve","reject","db","info","then","res","close","catch","err","getAll","options","a","allDocs","include_docs","get","docId","Error","put","doc","update","_id","resGet","_rev","resPut","errPut","remove","resRm","errRm","url","port","username","password","onSuccess","onError","connected","hostname","isFunction","brokerUrl","mqtt","keepalive","reconnectPeriod","on","stream","error","name","end","getClientInstance","subscribe","topic","onMessageReceived","qos","payload","data","parseCurrentSettings","toString","unsubscribe","disconnect","callback","throwDbError","additionalMsg","getSavedDevices","rows","i","getDevice","updateDevice","deviceData","deleteDevice","deviceID","addDevice","connectDevice","mqttClient","dbClient","onSubscribe","Date","now","getAllData","getLastData","descending","limit","getPageData","skip","getAllDataCount","total_rows","testDeviceConnection","DevicesList","onSelect","onEdit","onDelete","useState","selectedElement","setSelectedElement","handleSelect","onClick","protocolOptions","val","toUpperCase","kindOptions","option","validationSchema","Yup","shape","max","matches","required","positive","integer","DeviceModal","isOpen","onClose","onSave","onUpdate","initialValues","updateMode","isEmpty","footerMessage","setFooterMessage","formRef","useRef","_initialValues","v","useEffect","setTimeout","onSubmit","values","renderFooterMessage","state","onRequestClose","iconColor","animated","hasCloseButton","requestCloseOnBackdrop","requestCloseOnEsc","fluid","wrapperComponent","Form","wrapperProps","innerRef","Header","Body","placeholder","disabled","inputClassName","leadingInlineAddon","renderOption","o","getValue","Footer","stopPropagation","current","BroadcastDevices","history","match","render","setRender","isModalOpen","setIsModalOpen","devicesList","setDevicesList","onEditValues","setOnEditValues","list","device","push"],"mappings":"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","file":"static/js/8.76aec0dc.chunk.js","sourcesContent":["import legoinoDeviceInformation from 'legoino-device-information';\n\n// Default Values\n\nexport const DEVICES_DB = 'BIOREACTOR_devices';\nexport const DEFAULT_PORT =\n  window.location.protocol === 'https:' ? '443' : '80'; // old '8080'\nexport const DEFAULT_PROTOCOL =\n  window.location.protocol === 'https:' ? 'wss' : 'http'; // old tcp\n\n// Static Values\n\nexport const DEVICE_PROTOCOLS = ['http', 'tcp', 'wss'];\n\nexport const COMMANDS = {\n  help: 'h',\n  settings: 'u',\n  compactSettings: 'uc',\n  runExperiment: 'r',\n  kinetic: 'k',\n  reset: 'ur1234',\n  sleep: 'l',\n  setParameter: (label, value) => `${label}${value}`,\n};\n\nexport const DEVICE_KINDS = Object.keys(legoinoDeviceInformation).map(\n  (key) => legoinoDeviceInformation[key].kind,\n);\n\nexport const DEVICE_KINDS_OPTIONS = Object.keys(legoinoDeviceInformation)\n  .filter((key) => legoinoDeviceInformation[key].kind)\n  .map((key) => ({\n    ...legoinoDeviceInformation[key],\n    label: legoinoDeviceInformation[key].kind,\n    type: 'option',\n  }));\n\nexport const DEVICE_STATUS = {\n  opening: 1,\n  opened: 2,\n  closed: 3,\n  missing: 9,\n  error: 10,\n};\n\nexport const DEVICE_TYPE = {\n  broadcast: 'broadcast',\n  interactive: 'interactive',\n  local: 'local',\n};\n\nexport const getDeviceType = (deviceId) => {\n  try {\n    if (deviceId) {\n      const selectedDeviceType = legoinoDeviceInformation.fromDeviceID(\n        Number(deviceId),\n      );\n      return DEVICE_KINDS_OPTIONS.filter(\n        (element) => element.id === selectedDeviceType.id,\n      )[0];\n    }\n  } catch (e) {\n    console.log(e);\n    return undefined;\n  }\n};\n","import clsx from 'clsx';\nimport {\n  SvgOutlineExclamationCircle,\n  SvgSolidExclamation,\n  useNotificationCenter,\n} from '../components/tailwind-ui';\n\nexport default function useNotification() {\n  const notificationContext = useNotificationCenter();\n\n  const addNotification = (title, message, { textColor, Icon, timeout }) => {\n    notificationContext.addNotification(\n      {\n        title: (\n          <span className={clsx('text-base font-semibold', textColor + '500')}>\n            {title}\n          </span>\n        ),\n        content: <span className=\"text-sm text-neutral-500\">{message}</span>,\n        icon: <Icon className={clsx('w-8 h-8', textColor + '600')} />,\n      },\n      timeout,\n    );\n  };\n\n  const addInfoNotification = (title, message, timeout = 1000) => {\n    addNotification(title, message, {\n      textColor: 'text-primary-',\n      Icon: SvgOutlineExclamationCircle,\n      timeout: timeout,\n    });\n  };\n\n  const addWarningNotification = (title, message, timeout = 2500) => {\n    addNotification(title, message, {\n      textColor: 'text-warning-',\n      Icon: SvgSolidExclamation,\n      timeout: timeout,\n    });\n  };\n\n  const addErrorNotification = (title, message, timeout = 5000) => {\n    addNotification(title, message, {\n      textColor: 'text-danger-',\n      Icon: SvgSolidExclamation,\n      timeout: timeout,\n    });\n  };\n\n  return { addErrorNotification, addWarningNotification, addInfoNotification };\n}\n","import mqtt from 'mqtt';\nimport { isFunction } from 'lodash';\nimport { parseCurrentSettings } from 'legoino-util';\n\n// Private Functions\nlet client;\n\nconst getClientInstance = (\n  url,\n  protocol,\n  port,\n  username,\n  password,\n  onSuccess,\n  onError,\n) => {\n  // if client is already connected\n  if (client && client.connected && client.options.hostname === url)\n    isFunction(onSuccess) && onSuccess(client);\n\n  const brokerUrl = `${protocol}://${url}:${port}`;\n  client = mqtt.connect(brokerUrl, {\n    keepalive: 300,\n    reconnectPeriod: 5000,\n  });\n\n  client.on('connect', () => {\n    console.log(`connected to ${brokerUrl} : ${client.connected}`);\n    isFunction(onSuccess) && onSuccess(client);\n  });\n\n  client.stream.on('error', (err) => {\n    console.log(err);\n    const error = new Error(`Couldn't connect to BROKER \"${brokerUrl}\"`);\n    error.name = 'Mqtt Error';\n    client.end();\n    isFunction(onError) && onError(error);\n  });\n};\n\nconst parseToJson = (data) => {\n  return parseCurrentSettings(data.toString(), {});\n};\n\n// Public Functions\n\nexport const connect = (url, protocol, port, username, password) => {\n  const clientPromise = new Promise((resolve, reject) => {\n    getClientInstance(\n      url,\n      protocol,\n      port,\n      username,\n      password,\n      (client) => resolve(client),\n      (error) => reject(error),\n    );\n  });\n  return clientPromise;\n};\n\n// TO DO: update function\n\nexport const subscribe = (client, topic, onMessageReceived, onError) => {\n  client.subscribe(topic, { qos: 2 }, (err) => {\n    err\n      ? isFunction(onError) && onError(err)\n      : client.on('message', (topic, payload) => {\n          isFunction(onMessageReceived) &&\n            onMessageReceived(parseToJson(payload));\n        });\n  });\n\n  const unsubscribe = (onError) => client.unsubscribe(topic, {}, onError);\n\n  return unsubscribe;\n};\n\nexport const disconnect = (client, callback) =>\n  client.end(() => {\n    console.log(`mqtt broker \"${client.options.hostname}\" disconnected`);\n    isFunction(callback) && callback();\n  });\n","import PouchDB from 'pouchdb';\n\n// Wrap Db interface in case of switching to another Db other than \"PouchDb\"\n\nconst DB = (dbName) => {\n  const connect = () => new PouchDB(dbName);\n\n  // DB operations to return\n\n  const getInfo = () =>\n    new Promise((resolve, reject) => {\n      const db = connect();\n      db.info()\n        .then((res) => db.close(() => resolve(res)))\n        .catch((err) => db.close(() => reject(err)));\n    });\n\n  const getAll = async (options) =>\n    new Promise((resolve, reject) => {\n      const db = connect();\n      db.allDocs({\n        include_docs: true,\n        ...options,\n      })\n        .then((res) => db.close(() => resolve(res)))\n        .catch((err) => db.close(() => reject(err)));\n    });\n\n  const get = (docId) =>\n    new Promise((resolve, reject) => {\n      const db = connect();\n      docId\n        ? db\n            .get(docId)\n            .then((res) => db.close(() => resolve(res)))\n            .catch((err) => db.close(() => reject(err)))\n        : reject(new Error('Doc fetch : docId is required'));\n    });\n\n  const put = (doc) =>\n    new Promise((resolve, reject) => {\n      const db = connect();\n      !('_id' in doc)\n        ? reject(new Error('Doc create : _id is required in doc'))\n        : db\n            .put(doc)\n            .then((res) => db.close(() => resolve(res)))\n            .catch((err) => db.close(() => reject(err)));\n    });\n\n  const update = (doc) =>\n    new Promise((resolve, reject) => {\n      const db = connect();\n      !('_id' in doc)\n        ? reject(new Error('Doc update : _id is required in doc'))\n        : db\n            .get(doc._id)\n            .then((resGet) =>\n              db\n                .put({ ...doc, _rev: resGet._rev })\n                .then((resPut) => db.close(() => resolve(resPut)))\n                .catch((errPut) => reject(errPut)),\n            )\n            .catch((err) => db.close(() => reject(err)));\n    });\n\n  const remove = (docId) =>\n    new Promise((resolve, reject) => {\n      const db = connect();\n      docId\n        ? db\n            .get(docId)\n            .then((resGet) =>\n              db\n                .remove({ _id: docId, _rev: resGet._rev })\n                .then((resRm) => db.close(() => resolve(resRm)))\n                .catch((errRm) => reject(errRm)),\n            )\n            .catch((err) => db.close(() => reject(err)))\n        : reject(new Error('Doc remove : docId is required'));\n    });\n\n  return {\n    getInfo,\n    getAll,\n    get,\n    put,\n    update,\n    remove,\n  };\n};\n\nexport default DB;\n","import DB from './db';\nimport { isFunction } from 'lodash';\nimport { connect, subscribe, disconnect } from './mqttService';\nimport { DEVICES_DB, DEFAULT_PORT, DEFAULT_PROTOCOL } from './devicesOptions';\n\n// Private Functions\n\nconst throwDbError = (error, additionalMsg) => {\n  console.log(error);\n  const err = new Error(`${additionalMsg} \\n${error?.message}`);\n  err.name = 'DATABASE_ERROR';\n  throw err;\n};\n\n// Public Functions\n\n// export const getSavedDevices = async () => {\n//   const dbClient = DB(DEVICES_DB);\n//   const list = await dbClient.getAll();\n//   return list.map((item) => item.doc);\n// };\nexport const getSavedDevices = async () =>\n  DB(DEVICES_DB)\n    .getAll()\n    .then((res) => res.rows.map((i) => i.doc))\n    .catch((e) => throwDbError(e, `Get locally saved devices error`));\n\n// export const getDevice = async (deviceId) => {\n//   const dbClient = db.connect(DEVICES_DB);\n//   const device = await dbClient.get(deviceId);\n//   return device;\n// };\nexport const getDevice = async (deviceId) =>\n  DB(DEVICES_DB)\n    .get(deviceId)\n    .catch((e) => throwDbError(e, `Get device error`));\n\n// export const updateDevice = async (deviceData) => {\n//   const dbClient = db.connect(DEVICES_DB);\n//   return dbClient.update(deviceData);\n// };\nexport const updateDevice = async (deviceData) =>\n  DB(DEVICES_DB)\n    .update(deviceData)\n    .catch((e) => throwDbError(e, `Update device error`));\n\n// export const deleteDevice = (deviceID) => {\n//   const dbClient = db.connect(DEVICES_DB);\n//   return dbClient.remove(deviceID).catch((e) => {\n//     const err = new Error(`Couldn't remove record: ${e.message}`);\n//     err.name = 'Database Error';\n//     throw err;\n//   });\n// };\nexport const deleteDevice = (deviceID) =>\n  DB(DEVICES_DB)\n    .remove(deviceID)\n    .catch((e) => throwDbError(e, `Delete device error`));\n\n// add device to devices DB\n\nexport const addDevice = ({\n  kind,\n  name,\n  url,\n  protocol = DEFAULT_PROTOCOL,\n  port = DEFAULT_PORT,\n  topic,\n  username,\n  password,\n}) =>\n  DB(DEVICES_DB)\n    .put({\n      _id: `${kind}_${name}`,\n      name,\n      url,\n      protocol,\n      port,\n      topic,\n      kind,\n      username,\n      password,\n    })\n    .catch((e) =>\n      e.name === 'conflict'\n        ? throwDbError(e, `Device name must be unique`)\n        : throwDbError(e, `Insert device error`),\n    );\n\n// export const addDevice2 = (props) => {\n//   const dbClient = db.connect(DEVICES_DB);\n//   const { kind, name, url, protocol, port, topic, username, password } = props;\n\n//   // make sure all props are defined\n//   for (let key in props)\n//     if (!props[key]) throw new Error(`Field missing [${key}]`);\n\n//   const id = `${kind}_${name}`;\n\n//   return dbClient\n//     .get(id)\n//     .then((r) => {\n//       // the device already exists in DB\n//       const err = new Error('Another device exists with the same name');\n//       err.payload = { exist: true, payload: r };\n//       throw err;\n//     })\n//     .catch((e) => {\n//       // if the device exists in DB\n//       if (e.payload && e.payload.exist) throw e;\n//       // the device does not exist in DB\n//       return dbClient\n//         .put({\n//           _id: id,\n//           name,\n//           url,\n//           protocol,\n//           port,\n//           topic,\n//           kind,\n//           username,\n//           password,\n//         })\n//         .then((r) => {\n//           // inserted successfully\n//           return { exist: false, inserted: true, payload: r };\n//         })\n//         .catch((e) => {\n//           // DB error\n//           const err = new Error(e.toString());\n//           err.payload = {\n//             exist: false,\n//             inserted: false,\n//             payload: e.toString(),\n//           };\n//           throw err;\n//         });\n//     });\n// };\n\n//\n// connect to broadcast device & return a client instance with {subscribe, disconnect, getAllData, getLastData}\nexport const connectDevice = ({\n  _id,\n  name,\n  kind,\n  deviceId = _id || `${kind}_${name}`,\n  url,\n  protocol = DEFAULT_PROTOCOL,\n  port = DEFAULT_PORT,\n  topic,\n  username,\n  password,\n}) => {\n  const clientPromise = new Promise(async (resolve, reject) => {\n    try {\n      const mqttClient = await connect(url, protocol, port, username, password);\n      const dbClient = DB(deviceId);\n\n      const _subscribe = (onSubscribe, onError) => {\n        const unsubscribe = subscribe(\n          mqttClient,\n          topic,\n          (payload) => {\n            dbClient.put({ _id: Date.now().toString(), ...payload });\n            isFunction(onSubscribe) && onSubscribe(payload);\n          },\n          onError,\n        );\n        return unsubscribe;\n      };\n\n      const _disconnect = () => disconnect(mqttClient);\n\n      const getAllData = () =>\n        dbClient.getAll().then((res) => res.rows.map((i) => i.doc));\n\n      const getLastData = () =>\n        dbClient\n          .getAll({ descending: true, limit: 1 })\n          .then((res) => res.rows.map((i) => i.doc));\n\n      const getPageData = (skip, limit) =>\n        dbClient\n          .getAll({ descending: true, skip: skip, limit: limit })\n          .then((res) => res.rows.map((i) => i.doc));\n\n      const getAllDataCount = () =>\n        dbClient.getAll().then((res) => res.total_rows);\n\n      resolve({\n        subscribe: _subscribe,\n        disconnect: _disconnect,\n        getAllData,\n        getLastData,\n        getPageData,\n        getAllDataCount,\n      });\n    } catch (e) {\n      // connection error\n      reject(e);\n    }\n  });\n\n  return clientPromise;\n};\n\nexport const testDeviceConnection = ({\n  url,\n  protocol = DEFAULT_PROTOCOL,\n  port = DEFAULT_PORT,\n  topic,\n  username,\n  password,\n}) => {\n  const clientPromise = new Promise(async (resolve, reject) => {\n    try {\n      const mqttClient = await connect(url, protocol, port, username, password);\n      const unsubscribe = subscribe(\n        mqttClient,\n        topic,\n        (payload) => {\n          unsubscribe();\n          disconnect(mqttClient, () => resolve(payload));\n        },\n        reject,\n      );\n    } catch (e) {\n      // connection error\n      reject(e);\n    }\n  });\n\n  return clientPromise;\n};\n","import { isFunction } from 'lodash';\nimport { useState } from 'react';\nimport {\n  Spinner,\n  SvgOutlineChevronRight,\n  SvgSolidCog,\n  SvgSolidTrash,\n} from '../../components/tailwind-ui';\n\nconst DevicesList = ({ data, onSelect, onEdit, onDelete }) => {\n  const [selectedElement, setSelectedElement] = useState();\n\n  const handleSelect = async (element, e) => {\n    // ignore click if another element is already selected (is loading)\n    if (!selectedElement) {\n      setSelectedElement(element);\n      const callback = () => setSelectedElement(null);\n      isFunction(onSelect) && onSelect(element, e, callback);\n    }\n  };\n  return (\n    <div className=\"overflow-hidden bg-white shadow sm:rounded-md\">\n      {data.map((element) => (\n        <li\n          key={element.kind + element.name}\n          className=\"block transition duration-150 ease-in-out hover:bg-gray-50 focus:outline-none focus:bg-gray-50 cursor-pointer\"\n          onClick={(e) => handleSelect(element, e)}\n        >\n          <div className=\"relative flex items-center px-4 py-4 sm:px-6\">\n            {selectedElement === element && ( // if element is selected, display spinner\n              <div className=\"absolute top-0 left-0 w-full h-full opacity-30 bg-neutral-300\">\n                <div className=\"w-full h-full flex justify-center items-center\">\n                  <Spinner className=\"w-8 h-8 text-primary-800\" />\n                </div>\n              </div>\n            )}\n            <div className=\"flex items-center flex-1 min-w-0\">\n              <div className=\"flex-1 min-w-0 px-4 sm:grid sm:grid-col-2 sm:gap-4\">\n                <p className=\"col-span-2 text-lg font-semibold truncate text-primary-700\">\n                  {element.name}\n                </p>\n                <div className=\"flex flex-col text-xs font-italic text-neutral-600\">\n                  <p className=\"truncate\">\n                    <span className=\"font-semibold\">Device kind : </span>\n                    {element.kind}\n                  </p>\n                  <p className=\"truncate\">\n                    <span className=\"font-semibold\">URL : </span>\n                    {`${element.protocol}://${element.url}:${element.port}`}\n                  </p>\n                  <p className=\"truncate\">\n                    <span className=\"font-semibold\">Topic : </span>\n                    {element.topic}\n                  </p>\n                </div>\n                <div className=\"pt-2 sm:pt-0 flex justify-end items-center cursor-default\">\n                  <button\n                    className=\"mx-1 p-2 border rounded shadow-sm bg-neutral-100 focus:outline-none active:bg-neutral-200\"\n                    onClick={(e) => onEdit(element, e)}\n                  >\n                    <SvgSolidCog className=\"text-gray-700\" />\n                  </button>\n                  <button\n                    className=\"mx-1 p-2 border rounded shadow-sm bg-neutral-100 focus:outline-none active:bg-neutral-200\"\n                    onClick={(e) => onDelete(element, e)}\n                  >\n                    <SvgSolidTrash className=\"text-gray-700\" />\n                  </button>\n                </div>\n              </div>\n            </div>\n            <div>\n              <SvgOutlineChevronRight className=\"w-5 h-5 text-neutral-400\" />\n            </div>\n          </div>\n          <div className=\"w-full border-t border-neutral-100\" />\n        </li>\n      ))}\n    </div>\n  );\n};\n\nexport default DevicesList;\n","import { useRef, useState, useEffect } from 'react';\nimport * as Yup from 'yup';\nimport { isFunction, isEmpty } from 'lodash';\nimport {\n  Form,\n  InputField,\n  Modal,\n  SvgOutlinePlus,\n  FormError,\n  SubmitButton,\n  SvgOutlineUser,\n  SvgOutlineKey,\n  SvgOutlineLink,\n  SvgOutlineX,\n  SelectField,\n  Spinner,\n  SvgOutlineCheck,\n} from '../../components/tailwind-ui';\n\nimport { testDeviceConnection } from '../../services/broadCastDeviceService';\nimport {\n  DEFAULT_PORT,\n  DEFAULT_PROTOCOL,\n  DEVICE_KINDS_OPTIONS,\n  DEVICE_PROTOCOLS,\n} from '../../services/devicesOptions';\n\n//\n// Pre-defined Vars\nconst protocolOptions = DEVICE_PROTOCOLS.map((val) => {\n  return { label: val.toUpperCase(), value: val };\n});\nconst kindOptions = DEVICE_KINDS_OPTIONS.map((option) => {\n  return { ...option, value: option.kind };\n});\nconst validationSchema = Yup.object().shape({\n  name: Yup.string()\n    .max(50, 'Name too Long!')\n    .matches(\n      /^[A-z0-9_-]*$/,\n      'Field supports only : letters / numbers / _ / - ',\n    )\n    .required('Required'),\n  url: Yup.string().required('Required'),\n  port: Yup.number().positive().integer(),\n  protocol: Yup.string(),\n  kind: Yup.string().required('Required'),\n  topic: Yup.string().required('Required'),\n  username: Yup.string().required('Required'),\n});\n//\n\nconst DeviceModal = ({ isOpen, onClose, onSave, onUpdate, initialValues }) => {\n  const updateMode = !isEmpty(initialValues); // if initialValues defined : updates the recode; else: add the record\n  const [footerMessage, setFooterMessage] = useState(<div />);\n  const formRef = useRef(null); // Ref the Form\n\n  const _initialValues = {\n    name: 'Computer',\n    url: 'mqtt.hackuarium.org',\n    protocol: protocolOptions.filter((v) => v.value === DEFAULT_PROTOCOL)[0]\n      .value,\n    port: DEFAULT_PORT,\n    kind: kindOptions[0].value,\n    topic: 'lpatiny/Computer/server',\n    username: 'testUser',\n    password: 'word',\n    ...initialValues,\n  };\n\n  useEffect(() => {\n    // clear footer when modal is closed\n    !isOpen && setTimeout(() => setFooterMessage(<div />), 500);\n  }, [isOpen]);\n\n  // events functions\n  const onSubmit = async (values) => {\n    try {\n      //await addDevice(values);\n      updateMode\n        ? isFunction(onUpdate) && (await onUpdate(values))\n        : isFunction(onSave) && (await onSave(values));\n      isFunction(onClose) && onClose();\n    } catch (e) {\n      throw new Error(e.message);\n    }\n  };\n\n  const testConnection = (e) => {\n    e.stopPropagation();\n    renderFooterMessage('connecting', 'Connecting ...');\n    setTimeout(() => {\n      testDeviceConnection(formRef.current.values)\n        .then(() => {\n          renderFooterMessage('success', 'Connected');\n        })\n        .catch((err) => {\n          renderFooterMessage('error', `Connection Error: ${err.message}`);\n        });\n    }, 500);\n  };\n\n  // helper function for testConnection event\n  const renderFooterMessage = (state, message) => {\n    switch (state) {\n      case 'connecting':\n        setFooterMessage(\n          <div className=\"mx-6 flex flex-row items-center text-sm text-left text-neutral-500\">\n            <Spinner className=\"w-6 h-6 mr-2\" />\n            <span>{message}</span>\n          </div>,\n        );\n        break;\n\n      case 'success':\n        setFooterMessage(\n          <div className=\"mx-4 flex flex-row items-center text-sm text-left text-success-500\">\n            <SvgOutlineCheck className=\"h-6 w-6 mr-4\" />\n            <span>{message}</span>\n          </div>,\n        );\n        break;\n\n      case 'error':\n        setFooterMessage(\n          <div className=\"mx-4 flex flex-row items-center text-sm text-left text-danger-500\">\n            <SvgOutlineX className=\"h-6 w-6 mr-4\" />\n            <span>{message}</span>\n          </div>,\n        );\n        break;\n\n      default:\n        setFooterMessage(<div />);\n        break;\n    }\n  };\n\n  return (\n    <Modal\n      isOpen={isOpen}\n      onRequestClose={onClose}\n      icon={<SvgOutlinePlus />}\n      iconColor=\"neutral\"\n      animated\n      hasCloseButton\n      requestCloseOnBackdrop\n      requestCloseOnEsc\n      fluid\n      wrapperComponent={Form}\n      wrapperProps={{\n        innerRef: formRef,\n        initialValues: _initialValues,\n        validationSchema,\n        onSubmit: onSubmit,\n        className: 'h-full',\n      }}\n    >\n      <Modal.Header>Connect New Device</Modal.Header>\n      <Modal.Body>\n        <div className=\"p-2 mt-2\">\n          <InputField\n            name=\"name\"\n            id=\"name\"\n            label=\"Custom name\"\n            placeholder=\"Device name\"\n            disabled={updateMode}\n            required\n            className=\"w-full\"\n            inputClassName=\"w-full\"\n          ></InputField>\n          <div className=\"flex flex-col sm:flex-row sm:justify-between mt-4 sm:mt-0 border-t border-neutral sm:border-0\">\n            <InputField\n              name=\"url\"\n              id=\"url\"\n              label=\"URL\"\n              placeholder=\"mqtt.domain.com\"\n              required\n              leadingInlineAddon={<SvgOutlineLink />}\n              className=\"mt-4 sm:mr-4 w-full sm:w-1/2\"\n              inputClassName=\"w-full\"\n            ></InputField>\n            <div className=\"flex flex-row justify-between items-start flex-1\">\n              <SelectField\n                name=\"protocol\"\n                id=\"protocol\"\n                label=\"Protocol\"\n                options={protocolOptions}\n                renderOption={(o) => `${o.label}`}\n                getValue={(o) => o.value}\n                className=\"mt-4 mr-4 w-1/2\"\n                inputClassName=\"w-full\"\n              ></SelectField>\n              <InputField\n                name=\"port\"\n                id=\"port\"\n                label=\"Port\"\n                className=\"mt-4 flex-1\"\n                inputClassName=\"w-full\"\n              ></InputField>\n            </div>\n          </div>\n          <div className=\"flex flex-row justify-between items-start\">\n            <SelectField\n              name=\"kind\"\n              id=\"kind\"\n              label=\"Device kind\"\n              options={kindOptions}\n              renderOption={(o) => `${o.label}`}\n              getValue={(o) => o.value}\n              required\n              className=\"mt-4 mr-4 w-1/3 \"\n              inputClassName=\"w-full bg-gray-500\"\n            ></SelectField>\n            <InputField\n              name=\"topic\"\n              id=\"topic\"\n              label=\"Topic\"\n              required\n              className=\"mt-4 flex-1\"\n              inputClassName=\"w-full\"\n            ></InputField>\n          </div>\n\n          <div className=\"flex flex-col sm:flex-row sm:justify-between mt-4 sm:mt-0 border-t border-neutral sm:border-0\">\n            <InputField\n              name=\"username\"\n              id=\"username\"\n              label=\"Username\"\n              placeholder=\"Username\"\n              required\n              leadingInlineAddon={<SvgOutlineUser />}\n              className=\"mt-4 w-full sm:mr-4 sm:w-1/2\"\n              inputClassName=\"w-full\"\n            ></InputField>\n            <InputField\n              name=\"password\"\n              id=\"password\"\n              label=\"Password\"\n              type=\"password\"\n              placeholder=\"********\"\n              required\n              leadingInlineAddon={<SvgOutlineKey />}\n              className=\"mt-4 w-full sm:flex-1\"\n              inputClassName=\"w-full\"\n            ></InputField>\n          </div>\n        </div>\n        <FormError />\n      </Modal.Body>\n      <Modal.Footer>\n        <div className=\"flex flex-col sm:flex-row items-center\">\n          {footerMessage}\n          <button\n            onClick={testConnection}\n            type=\"button\"\n            className=\"w-full sm:w-max mt-2 sm:my-0 px-4 py-2 sm:mr-4 text-sm font-semibold text-neutral-700 border rounded-md shadow bg-neutral-200 focus:outline-none flex-1 sm:flex-none\"\n          >\n            Test connection\n          </button>\n          <SubmitButton className=\"w-full my-2 sm:my-0 sm:w-max \">\n            {updateMode ? 'Update' : 'Add'}\n          </SubmitButton>\n        </div>\n      </Modal.Footer>\n    </Modal>\n  );\n};\n\nexport default DeviceModal;\n","import { useState, useEffect } from 'react';\nimport { isFunction } from 'lodash';\n\nimport { Button } from '../../components/tailwind-ui';\nimport {\n  addDevice,\n  updateDevice,\n  deleteDevice,\n  getSavedDevices,\n  testDeviceConnection,\n} from '../../services/broadCastDeviceService';\nimport useNotification from '../../hooks/useNotification';\nimport DevicesList from './DevicesList';\nimport DeviceModal from './DeviceModal';\n\nconst BroadcastDevices = ({ history, match }) => {\n  const [render, setRender] = useState(false);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [devicesList, setDevicesList] = useState([]);\n  const [onEditValues, setOnEditValues] = useState({});\n  const { addErrorNotification } = useNotification();\n\n  useEffect(() => {\n    // get saved devices from DB\n    getSavedDevices().then((list) => setDevicesList(list));\n  }, [render]);\n\n  const onOpenModal = () => {\n    setOnEditValues({});\n    setIsModalOpen(true);\n  };\n\n  const onCloseModal = () => {\n    setRender(!render); // refresh devices list\n    setIsModalOpen(false); // close modal\n  };\n\n  const onSelectItem = (device, e, callback) => {\n    setTimeout(async () => {\n      testDeviceConnection(device)\n        .then(() => {\n          isFunction(callback) && callback();\n          history.push(match.url + '/device/' + device._id);\n        })\n        .catch((err) => {\n          addErrorNotification(e.name, e.message);\n          isFunction(callback) && callback();\n        });\n    }, 500);\n  };\n\n  const onEditItem = (device, e) => {\n    e.stopPropagation();\n    setOnEditValues(device);\n    setIsModalOpen(true);\n  };\n\n  const onDeleteItem = (device, e) => {\n    e.stopPropagation();\n    deleteDevice(device._id)\n      .then(() => setRender(!render))\n      .catch((e) => addErrorNotification(e.name, e.message));\n  };\n\n  return (\n    <div className=\"p-8\">\n      <h2 className=\"text-3xl font-semibold mb-10\">Broadcast devices</h2>\n      <div className=\"w-full flex justify-end mb-4\">\n        <Button onClick={onOpenModal}>Add device</Button>\n      </div>\n      <div>\n        <div className=\"w-full my-2 flex flex-row items-center \">\n          <h3 className=\"w-max ml-2 mr-4 text-neutral-600 text-sm whitespace-nowrap \">\n            Available devices\n          </h3>\n          <div className=\"w-full border-t border-neutral-300\" />\n        </div>\n        <DevicesList\n          data={devicesList}\n          onSelect={onSelectItem}\n          onEdit={onEditItem}\n          onDelete={onDeleteItem}\n        />\n      </div>\n\n      <DeviceModal\n        isOpen={isModalOpen}\n        onClose={onCloseModal}\n        initialValues={onEditValues}\n        onSave={addDevice}\n        onUpdate={updateDevice}\n      ></DeviceModal>\n    </div>\n  );\n};\n\nexport default BroadcastDevices;\n"],"sourceRoot":""}