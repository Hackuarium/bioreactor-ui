(this["webpackJsonpbioreactor-ui"]=this["webpackJsonpbioreactor-ui"]||[]).push([[10],{106:function(e,t,n){"use strict";n.d(t,"d",(function(){return i})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return u})),n.d(t,"f",(function(){return l})),n.d(t,"g",(function(){return d})),n.d(t,"a",(function(){return f})),n.d(t,"e",(function(){return m}));var r=n(3),c=n(115),o=n.n(c),a=["events","parameters"],i="BIOREACTOR-UI_devices",s="https:"===window.location.protocol?"443":"80",u="https:"===window.location.protocol?"wss":"http",l=["http","tcp","wss"],d={broadcast:"broadcast",interactive:"interactive",local:"local"},f={help:"h",settings:"u",compactSettings:"uc",runExperiment:"r",kinetic:"k",reset:"ur1234",sleep:"l",setParameter:function(e,t){return"".concat(e).concat(t)}},m=Object.keys(o.a).filter((function(e){return o.a[e].kind})).map((function(e){var t=o.a[e];t.events,t.parameters;return Object(r.a)(t,a)}))},112:function(e,t,n){"use strict";var r=n(53),c=n.n(r),o=n(1),a=n(59),i=n(141);t.a=function(e){var t=function(){return new i.a(e,{revs_limit:1,auto_compaction:!0})};return{getInfo:function(){return new Promise((function(e,n){var r=t();r.info().then((function(t){return r.close((function(){return e(t)}))})).catch((function(e){return r.close((function(){return n(e)}))}))}))},getAll:function(){var e=Object(a.a)(c.a.mark((function e(n){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var c=t();c.allDocs(Object(o.a)({include_docs:!0},n)).then((function(t){return c.close((function(){return e(t)}))})).catch((function(e){return c.close((function(){return r(e)}))}))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),get:function(e){return new Promise((function(n,r){var c=t();e?c.get(e).then((function(e){return c.close((function(){return n(e)}))})).catch((function(e){return c.close((function(){return r(e)}))})):r(new Error("Doc fetch : docId is required"))}))},put:function(e){return new Promise((function(n,r){var c=t();"_id"in e?c.put(e).then((function(e){return c.close((function(){return n(e)}))})).catch((function(e){return c.close((function(){return r(e)}))})):r(new Error("Doc create : _id is required in doc"))}))},update:function(e){return new Promise((function(n,r){var c=t();"_id"in e?c.get(e._id).then((function(t){return c.put(Object(o.a)(Object(o.a)({},e),{},{_rev:t._rev})).then((function(e){return c.close((function(){return n(e)}))})).catch((function(e){return r(e)}))})).catch((function(e){return c.close((function(){return r(e)}))})):r(new Error("Doc update : _id is required in doc"))}))},remove:function(e){return new Promise((function(n,r){var c=t();e?c.get(e).then((function(t){return c.remove({_id:e,_rev:t._rev}).then((function(e){return c.close((function(){return n(e)}))})).catch((function(e){return r(e)}))})).catch((function(e){return c.close((function(){return r(e)}))})):r(new Error("Doc remove : docId is required"))}))},destroy:function(){return t().destroy()}}}},116:function(e,t,n){"use strict";n.d(t,"c",(function(){return u})),n.d(t,"f",(function(){return l})),n.d(t,"e",(function(){return d})),n.d(t,"g",(function(){return f})),n.d(t,"d",(function(){return m})),n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return j}));var r=n(53),c=n.n(r),o=n(59),a=n(112),i=n(106),s=function(e,t){console.log(e);var n=new Error("".concat(t," \n").concat(null===e||void 0===e?void 0:e.message));throw n.name="DATABASE_ERROR",n},u=function(e,t,n){return"".concat(e,"_").concat(t,"_").concat(n)},l=function(){var e=Object(o.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(a.a)(i.d).getAll({startkey:"".concat(t),endkey:"".concat(t,"\uffff")}).then((function(e){return e.rows.map((function(e){return e.doc}))})).catch((function(e){return s(e,"Get locally saved devices error")})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d=function(){var e=Object(o.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(a.a)(i.d).get(t).catch((function(e){return s(e,"Get device error")})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),f=function(){var e=Object(o.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(a.a)(i.d).update(t).catch((function(e){return s(e,"Update device error")})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m=function(e){return Object(a.a)(i.d).remove(e).catch((function(e){return s(e,"Delete device error")}))},b=function(e,t){var n=t.kind,r=t.name,c=t.url,o=t.protocol,u=void 0===o?i.c:o,l=t.port,d=void 0===l?i.b:l,f=t.topic,m=t.username,b=t.password;return Object(a.a)(i.d).put({_id:"".concat(e,"_").concat(n,"_").concat(r),name:r,url:c,protocol:u,port:d,topic:f,kind:n,username:m,password:b}).catch((function(e){return"conflict"===e.name?s(e,"Device name must be unique"):s(e,"Insert device error")}))},j=function(e){return Object(a.a)(i.d).put(e).catch((function(e){return"conflict"===e.name?s(e,"Device name must be unique"):s(e,"Insert device error")}))}},117:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(4),c=n(20),o=n(0);function a(){var e=Object(c.O)(),t=function(t,n,c){var a=c.textColor,i=c.Icon,s=c.timeout;e.addNotification({title:Object(o.jsx)("span",{className:Object(r.a)("text-base font-semibold",a+"500"),children:t}),content:Object(o.jsx)("span",{className:"text-sm text-neutral-500",children:n}),icon:Object(o.jsx)(i,{className:Object(r.a)("w-8 h-8",a+"600")})},s)};return{addErrorNotification:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3;t(e,n,{textColor:"text-danger-",Icon:c.G,timeout:r})},addWarningNotification:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2500;t(e,n,{textColor:"text-warning-",Icon:c.G,timeout:r})},addInfoNotification:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;t(e,n,{textColor:"text-primary-",Icon:c.x,timeout:r})}}}},140:function(e,t,n){"use strict";n.d(t,"a",(function(){return x})),n.d(t,"b",(function(){return h}));var r,c=n(53),o=n.n(c),a=n(1),i=n(59),s=n(112),u=n(161),l=n.n(u),d=n(131),f=n(149),m=function(e,t,n,c,o){return new Promise((function(c,o){!function(e,t,n,c,o,a,i){r&&r.connected&&r.options.hostname===e&&Object(d.isFunction)(a)&&a(r);var s="".concat(t,"://").concat(e,":").concat(n);(r=l.a.connect(s,{keepalive:300,reconnectPeriod:5e3})).on("connect",(function(){console.log("connected to ".concat(s," : ").concat(r.connected)),Object(d.isFunction)(a)&&a(r)})),r.stream.on("error",(function(e){console.log(e);var t=new Error("Couldn't connect to BROKER \"".concat(s,'"'));t.name="Mqtt Error",r.end(),Object(d.isFunction)(i)&&i(t)}))}(e,t,n,0,0,(function(e){return c(e)}),(function(e){return o(e)}))}))},b=function(e,t,n,r){e.subscribe(t,{qos:2},(function(t){t?Object(d.isFunction)(r)&&r(t):e.on("message",(function(e,t){var r;Object(d.isFunction)(n)&&n((r=t,Object(f.parseCurrentSettings)(r.toString(),{})))}))}));return function(n){return e.unsubscribe(t,{},n)}},j=function(e,t){return e.end((function(){console.log('mqtt broker "'.concat(e.options.hostname,'" disconnected')),Object(d.isFunction)(t)&&t()}))},p=n(106),x=function(e){var t=e._id,n=e.name,r=e.kind,c=e.deviceId,u=void 0===c?t||"".concat(r,"_").concat(n):c,l=e.url,d=e.protocol,f=void 0===d?p.c:d,x=e.port,h=void 0===x?p.b:x,v=e.topic;e.username,e.password;return new Promise(function(){var e=Object(i.a)(o.a.mark((function e(t,n){var r,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m(l,f,h);case 3:r=e.sent,c=Object(s.a)(u),t({subscribe:function(e,t){return b(r,v,(function(t){c.put(Object(a.a)({_id:Date.now().toString()},t)),e(t)}),t)},disconnect:function(){return j(r)},getAllData:function(){return c.getAll().then((function(e){return e.rows.map((function(e){return e.doc}))}))},getLastData:function(){return c.getAll({descending:!0,limit:1}).then((function(e){return e.rows.map((function(e){return e.doc}))}))},getPageData:function(e,t){return c.getAll({descending:!0,skip:e,limit:t}).then((function(e){return e.rows.map((function(e){return e.doc}))}))},getAllDataCount:function(){return c.getAll().then((function(e){return e.total_rows}))}}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),n(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t,n){return e.apply(this,arguments)}}())},h=function(e){var t=e.url,n=e.protocol,r=void 0===n?p.c:n,c=e.port,a=void 0===c?p.b:c,s=e.topic;e.username,e.password;return new Promise(function(){var e=Object(i.a)(o.a.mark((function e(n,c){var i,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m(t,r,a);case 3:i=e.sent,u=b(i,s,(function(e){u(),j(i,(function(){return n(e)}))}),c),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),c(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}())}},142:function(e,t){},165:function(e,t){},166:function(e,t){},178:function(e,t){},179:function(e,t){},406:function(e,t,n){"use strict";n.r(t);var r=n(53),c=n.n(r),o=n(59),a=n(6),i=n(2),s=n(20),u=n(140),l=n(116),d=n(117),f=n(0),m=function(e){var t=e.data,n=e.onSelect,r=e.onEdit,u=e.onDelete,l=Object(i.useState)(),d=Object(a.a)(l,2),m=d[0],b=d[1],j=function(){var e=Object(o.a)(c.a.mark((function e(t,r){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:m||(b(t),n(t,r,(function(){return b(null)})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return Object(f.jsx)("div",{className:"overflow-hidden bg-white shadow sm:rounded-md",children:t.map((function(e){return Object(f.jsxs)("li",{className:"block transition duration-150 ease-in-out hover:bg-gray-50 focus:outline-none focus:bg-gray-50 cursor-pointer",onClick:function(t){return j(e,t)},children:[Object(f.jsxs)("div",{className:"relative flex items-center px-4 py-4 sm:px-6",children:[m===e&&Object(f.jsx)("div",{className:"absolute top-0 left-0 w-full h-full opacity-30 bg-neutral-300",children:Object(f.jsx)("div",{className:"w-full h-full flex justify-center items-center",children:Object(f.jsx)(s.n,{className:"w-8 h-8 text-primary-800"})})}),Object(f.jsx)("div",{className:"flex items-center flex-1 min-w-0",children:Object(f.jsxs)("div",{className:"flex-1 min-w-0 px-4 sm:grid sm:grid-col-2 sm:gap-4",children:[Object(f.jsx)("p",{className:"col-span-2 text-lg font-semibold truncate text-primary-700",children:e.name}),Object(f.jsxs)("div",{className:"flex flex-col text-xs font-italic text-neutral-600",children:[Object(f.jsxs)("p",{className:"truncate",children:[Object(f.jsx)("span",{className:"font-semibold",children:"Device kind : "}),e.kind]}),Object(f.jsxs)("p",{className:"truncate",children:[Object(f.jsx)("span",{className:"font-semibold",children:"URL : "}),"".concat(e.protocol,"://").concat(e.url,":").concat(e.port)]}),Object(f.jsxs)("p",{className:"truncate",children:[Object(f.jsx)("span",{className:"font-semibold",children:"Topic : "}),e.topic]})]}),Object(f.jsxs)("div",{className:"pt-2 sm:pt-0 flex justify-end items-center cursor-default",children:[Object(f.jsx)("button",{className:"mx-1 p-2 border rounded shadow-sm bg-neutral-100 focus:outline-none active:bg-neutral-200",onClick:function(t){return r(e,t)},children:Object(f.jsx)(s.F,{className:"text-gray-700"})}),Object(f.jsx)("button",{className:"mx-1 p-2 border rounded shadow-sm bg-neutral-100 focus:outline-none active:bg-neutral-200",onClick:function(t){return u(e,t)},children:Object(f.jsx)(s.I,{className:"text-gray-700"})})]})]})}),Object(f.jsx)("div",{children:Object(f.jsx)(s.s,{className:"w-5 h-5 text-neutral-400"})})]}),Object(f.jsx)("div",{className:"w-full border-t border-neutral-100"})]},e.kind+e.name)}))})},b=n(1),j=n(213),p=n(131),x=n(106),h=x.f.map((function(e){return{label:e.toUpperCase(),value:e}})),v=x.e.map((function(e){return Object(b.a)(Object(b.a)({},e),{},{label:e.name,value:e.kind})})),O=j.b().shape({name:j.c().max(50,"Name too Long!").matches(/^[A-z0-9_-]*$/,"Field supports only : letters / numbers / _ / - ").required("Required"),url:j.c().required("Required"),port:j.a().positive().integer(),protocol:j.c(),kind:j.c().required("Required"),topic:j.c().required("Required"),username:j.c().required("Required")}),w=function(e){var t=e.isOpen,n=e.onClose,r=e.onSave,l=e.onUpdate,d=e.initialValues,m=!Object(p.isEmpty)(d),j=Object(i.useState)(Object(f.jsx)("div",{})),w=Object(a.a)(j,2),g=w[0],N=w[1],k=Object(i.useRef)(null),y=Object(b.a)({name:"Computer",url:"mqtt.hackuarium.org",protocol:h.filter((function(e){return e.value===x.c}))[0].value,port:x.b,kind:v[0].value,topic:"lpatiny/Computer/server",username:"testUser",password:"word"},d);Object(i.useEffect)((function(){!t&&setTimeout((function(){return N(Object(f.jsx)("div",{}))}),500)}),[t]);var C=function(){var e=Object(o.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!m){e.next=6;break}return e.next=4,l(t);case 4:e.next=8;break;case 6:return e.next=8,r(x.g.broadcast,t);case 8:n(),e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(0),new Error(e.t0.message);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t){return e.apply(this,arguments)}}(),q=function(e,t){switch(e){case"connecting":N(Object(f.jsxs)("div",{className:"mx-6 flex flex-row items-center text-sm text-left text-neutral-500",children:[Object(f.jsx)(s.n,{className:"w-6 h-6 mr-2"}),Object(f.jsx)("span",{children:t})]}));break;case"success":N(Object(f.jsxs)("div",{className:"mx-4 flex flex-row items-center text-sm text-left text-success-500",children:[Object(f.jsx)(s.r,{className:"h-6 w-6 mr-4"}),Object(f.jsx)("span",{children:t})]}));break;case"error":N(Object(f.jsxs)("div",{className:"mx-4 flex flex-row items-center text-sm text-left text-danger-500",children:[Object(f.jsx)(s.E,{className:"h-6 w-6 mr-4"}),Object(f.jsx)("span",{children:t})]}));break;default:N(Object(f.jsx)("div",{}))}};return Object(f.jsxs)(s.j,{isOpen:t,onRequestClose:n,icon:Object(f.jsx)(s.B,{}),iconColor:"neutral",animated:!0,hasCloseButton:!0,requestCloseOnBackdrop:!0,requestCloseOnEsc:!0,fluid:!0,wrapperComponent:s.f,wrapperProps:{innerRef:k,initialValues:y,validationSchema:O,onSubmit:C,className:"h-full"},children:[Object(f.jsx)(s.j.Header,{children:"Connect New Device"}),Object(f.jsxs)(s.j.Body,{children:[Object(f.jsxs)("div",{className:"p-2 mt-2",children:[Object(f.jsx)(s.i,{name:"name",id:"name",label:"Custom name",placeholder:"Device name",disabled:m,required:!0,className:"w-full",inputClassName:"w-full"}),Object(f.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between mt-4 sm:mt-0 border-t border-neutral sm:border-0",children:[Object(f.jsx)(s.i,{name:"url",id:"url",label:"URL",placeholder:"mqtt.domain.com",required:!0,leadingInlineAddon:Object(f.jsx)(s.z,{}),className:"mt-4 sm:mr-4 w-full sm:w-1/2",inputClassName:"w-full"}),Object(f.jsxs)("div",{className:"flex flex-row justify-between items-start flex-1",children:[Object(f.jsx)(s.m,{name:"protocol",id:"protocol",label:"Protocol",options:h,renderOption:function(e){return"".concat(e.label)},getValue:function(e){return e.value},className:"mt-4 mr-4 w-1/2",inputClassName:"w-full"}),Object(f.jsx)(s.i,{name:"port",id:"port",label:"Port",className:"mt-4 flex-1",inputClassName:"w-full"})]})]}),Object(f.jsxs)("div",{className:"flex flex-row justify-between items-start",children:[Object(f.jsx)(s.m,{name:"kind",id:"kind",label:"Device kind",options:v,renderOption:function(e){return"".concat(e.label)},getValue:function(e){return e.value},required:!0,className:"mt-4 mr-4 w-1/2 ",inputClassName:"w-full bg-gray-500"}),Object(f.jsx)(s.i,{name:"topic",id:"topic",label:"Topic",required:!0,className:"mt-4 flex-1",inputClassName:"w-full"})]}),Object(f.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between mt-4 sm:mt-0 border-t border-neutral sm:border-0",children:[Object(f.jsx)(s.i,{name:"username",id:"username",label:"Username",placeholder:"Username",required:!0,leadingInlineAddon:Object(f.jsx)(s.D,{}),className:"mt-4 w-full sm:mr-4 sm:w-1/2",inputClassName:"w-full"}),Object(f.jsx)(s.i,{name:"password",id:"password",label:"Password",type:"password",placeholder:"********",required:!0,leadingInlineAddon:Object(f.jsx)(s.y,{}),className:"mt-4 w-full sm:flex-1",inputClassName:"w-full"})]})]}),Object(f.jsx)(s.g,{})]}),Object(f.jsx)(s.j.Footer,{children:Object(f.jsxs)("div",{className:"flex flex-col sm:flex-row items-center",children:[g,Object(f.jsx)("button",{onClick:function(e){e.stopPropagation(),q("connecting","Connecting ..."),setTimeout((function(){Object(u.b)(k.current.values).then((function(){q("success","Connected")})).catch((function(e){q("error","Connection Error: ".concat(e.message))}))}),500)},type:"button",className:"w-full sm:w-max mt-2 sm:my-0 px-4 py-2 sm:mr-4 text-sm font-semibold text-neutral-700 border rounded-md shadow bg-neutral-200 focus:outline-none flex-1 sm:flex-none",children:"Test connection"}),Object(f.jsx)(s.o,{className:"w-full my-2 sm:my-0 sm:w-max ",children:m?"Update":"Add"})]})})]})};t.default=function(e){var t=e.history,n=e.match,r=Object(i.useState)(!1),b=Object(a.a)(r,2),j=b[0],p=b[1],h=Object(i.useState)(!1),v=Object(a.a)(h,2),O=v[0],g=v[1],N=Object(i.useState)([]),k=Object(a.a)(N,2),y=k[0],C=k[1],q=Object(i.useState)({}),_=Object(a.a)(q,2),E=_[0],D=_[1],A=Object(d.a)().addErrorNotification;Object(i.useEffect)((function(){Object(l.f)(x.g.broadcast).then((function(e){return C(e)}))}),[j]);return Object(f.jsxs)("div",{className:"p-8",children:[Object(f.jsx)("h2",{className:"text-3xl font-semibold mb-10",children:"Broadcast devices"}),Object(f.jsx)("div",{className:"w-full flex justify-end mb-4",children:Object(f.jsx)(s.c,{onClick:function(){D({}),g(!0)},children:"Add device"})}),Object(f.jsxs)("div",{children:[Object(f.jsxs)("div",{className:"w-full my-2 flex flex-row items-center ",children:[Object(f.jsx)("h3",{className:"w-max ml-2 mr-4 text-neutral-600 text-sm whitespace-nowrap ",children:"Available devices"}),Object(f.jsx)("div",{className:"w-full border-t border-neutral-300"})]}),Object(f.jsx)(m,{data:y,onSelect:function(e,r,a){setTimeout(Object(o.a)(c.a.mark((function o(){return c.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:Object(u.b)(e).then((function(){a(),t.push(n.url+"/"+e._id)})).catch((function(e){A(r.name,r.message),a()}));case 1:case"end":return c.stop()}}),o)}))),500)},onEdit:function(e,t){t.stopPropagation(),D(e),g(!0)},onDelete:function(e,t){t.stopPropagation(),Object(l.d)(e._id).then((function(){return p(!j)})).catch((function(e){return A(e.name,e.message)}))}})]}),Object(f.jsx)(w,{isOpen:O,onClose:function(){p(!j),g(!1)},initialValues:E,onSave:l.a,onUpdate:l.g})]})}}}]);
//# sourceMappingURL=10.3cc94804.chunk.js.map