(self.webpackChunkbioreactor_ui=self.webpackChunkbioreactor_ui||[]).push([[610],{9783:function(n,e,t){"use strict";var r=t(4165),u=t(4925),o=t(5861),c=t(9439),i=t(1413),a=t(2791),s=t(1724),l=t(763),f=t(5749),d=t(5155),m=t(7104),p=t(184),v=["kind"],h=m.uv.map((function(n){return{label:n.toUpperCase(),value:n}})),w=m.cV.map((function(n){return(0,i.Z)((0,i.Z)({},n),{},{label:n.name,value:n.kind})})),x=s.Ry().shape({name:s.Z_().max(50,"Name too Long!").matches(/^[A-z0-9_-]*$/,"Field supports only : letters / numbers / _ / - ").required("Required"),url:s.Z_().required("Required"),port:s.Rx().positive().integer(),protocol:s.Z_(),kind:s.Z_().required("Required"),topic:s.Z_().required("Required"),username:s.Z_().required("Required")});e.Z=function(n){var e=n.isOpen,t=n.onClose,s=n.onSave,Z=n.onUpdate,b=n.initialValues,g=!(0,l.isEmpty)(b),k=(0,a.useState)((0,p.jsx)("div",{})),j=(0,c.Z)(k,2),_=j[0],C=j[1],N=(0,a.useRef)(null),y=g?(0,i.Z)((0,i.Z)({},b),{},{kind:b.kind.kind}):{name:"Computer_01",url:"mqtt.hackuarium.org",protocol:h.filter((function(n){return n.value===m.Bh}))[0].value,port:m.QT,kind:"Computer",topic:"lpatiny/Computer/server",username:"user",password:"password"};(0,a.useEffect)((function(){!e&&setTimeout((function(){return C((0,p.jsx)("div",{}))}),500)}),[e]);var q=function(){var n=(0,o.Z)((0,r.Z)().mark((function n(e){var o,c,a;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,o=e.kind,c=(0,u.Z)(e,v),a=m.cV.filter((function(n){return n.kind===o}))[0],!g){n.next=8;break}return n.next=6,Z((0,i.Z)((0,i.Z)({},c),{},{kind:a}));case 6:n.next=10;break;case 8:return n.next=10,s((0,i.Z)((0,i.Z)({},c),{},{kind:a}));case 10:t(),n.next=16;break;case 13:throw n.prev=13,n.t0=n.catch(0),new Error(n.t0.message);case 16:case"end":return n.stop()}}),n,null,[[0,13]])})));return function(e){return n.apply(this,arguments)}}(),P=function(n,e){switch(n){case"connecting":C((0,p.jsxs)("div",{className:"mx-6 flex flex-row items-center text-sm text-left text-neutral-500",children:[(0,p.jsx)(f.$jN,{className:"w-6 h-6 mr-2"}),(0,p.jsx)("span",{children:e})]}));break;case"success":C((0,p.jsxs)("div",{className:"mx-4 flex flex-row items-center text-sm text-left text-success-500",children:[(0,p.jsx)(f._yx,{className:"h-6 w-6 mr-4"}),(0,p.jsx)("span",{children:e})]}));break;case"error":C((0,p.jsxs)("div",{className:"mx-4 flex flex-row items-center text-sm text-left text-danger-500",children:[(0,p.jsx)(f.TW,{className:"h-6 w-6 mr-4"}),(0,p.jsx)("span",{children:e})]}));break;default:C((0,p.jsx)("div",{}))}};return(0,p.jsxs)(f.u_l,{isOpen:e,onRequestClose:t,icon:(0,p.jsx)(f.fUM,{}),iconColor:"neutral",animated:!0,hasCloseButton:!0,requestCloseOnBackdrop:!0,requestCloseOnEsc:!0,fluid:!0,wrapperComponent:f.l09,wrapperProps:{innerRef:N,initialValues:y,validationSchema:x,onSubmit:q,className:"h-full"},children:[(0,p.jsx)(f.u_l.Header,{children:g?"Update Device":"Connect New Device"}),(0,p.jsxs)(f.u_l.Body,{children:[(0,p.jsxs)("div",{className:"p-2 mt-2",children:[(0,p.jsx)(f.UPk,{name:"name",id:"name",label:"Custom name",placeholder:"Device name",disabled:g,required:!0,className:"w-full",inputClassName:"w-full"}),(0,p.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between mt-4 sm:mt-0 border-t border-neutral sm:border-0",children:[(0,p.jsx)(f.UPk,{name:"url",id:"url",label:"URL",placeholder:"mqtt.domain.com",required:!0,leadingInlineAddon:(0,p.jsx)(f.fq0,{}),className:"mt-4 sm:mr-4 w-full sm:w-1/2",inputClassName:"w-full"}),(0,p.jsxs)("div",{className:"flex flex-row justify-between items-start flex-1",children:[(0,p.jsx)(f.mgC,{name:"protocol",id:"protocol",label:"Protocol",options:h,renderOption:function(n){return"".concat(n.label)},getValue:function(n){return n.value},className:"mt-4 mr-4 w-1/2",inputClassName:"w-full"}),(0,p.jsx)(f.UPk,{name:"port",id:"port",label:"Port",className:"mt-4 flex-1",inputClassName:"w-full"})]})]}),(0,p.jsxs)("div",{className:"flex flex-row justify-between items-start",children:[(0,p.jsx)(f.mgC,{name:"kind",id:"kind",label:"Kind",options:w,renderOption:function(n){return"".concat(n.label)},getValue:function(n){return n.value},required:!0,className:"mt-4 mr-4 w-1/2 ",inputClassName:"w-full bg-gray-500"}),(0,p.jsx)(f.UPk,{name:"topic",id:"topic",label:"Topic",required:!0,className:"mt-4 flex-1",inputClassName:"w-full"})]}),(0,p.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between mt-4 sm:mt-0 border-t border-neutral sm:border-0",children:[(0,p.jsx)(f.UPk,{name:"username",id:"username",label:"Username",placeholder:"Username",required:!0,leadingInlineAddon:(0,p.jsx)(f.TbD,{}),className:"mt-4 w-full sm:mr-4 sm:w-1/2",inputClassName:"w-full"}),(0,p.jsx)(f.UPk,{name:"password",id:"password",label:"Password",type:"password",placeholder:"********",required:!0,leadingInlineAddon:(0,p.jsx)(f.hbj,{}),className:"mt-4 w-full sm:flex-1",inputClassName:"w-full"})]})]}),(0,p.jsx)(f.Xq4,{})]}),(0,p.jsx)(f.u_l.Footer,{children:(0,p.jsxs)("div",{className:"flex flex-col sm:flex-row items-center",children:[_,(0,p.jsx)("button",{onClick:function(n){n.stopPropagation(),P("connecting","Connecting ..."),setTimeout((function(){(0,d.hl)(N.current.values).then((function(){P("success","Connected")})).catch((function(n){P("error","Connection Error: ".concat(n.message))}))}),500)},type:"button",className:"w-full sm:w-max mt-2 sm:my-0 px-4 py-2 sm:mr-4 text-sm font-semibold text-neutral-700 border rounded-md shadow bg-neutral-200 focus:outline-none flex-1 sm:flex-none",children:"Test connection"}),(0,p.jsx)(f.Mmi,{className:"w-full my-2 sm:my-0 sm:w-max ",children:g?"Update":"Add"})]})})]})}},5155:function(n,e,t){"use strict";t.d(e,{cO:function(){return h},Xq:function(){return w},XS:function(){return Z},hl:function(){return x}});var r=t(4165),u=t(5861),o=t(1413),c=t(763),i=t(6917),a=t(2890),s=t(2154),l=function(n,e,t,r,u){var o=new Promise((function(r,u){!function(n,e,t,r,u,o,i){var s="".concat(e,"://").concat(n,":").concat(t),l=a.connect(s,{keepalive:300,reconnectPeriod:5e3});l.on("connect",(function(){(0,c.isFunction)(o)&&o(l)})),l.stream.on("error",(function(n){var e=new Error("Couldn't connect to BROKER \"".concat(s,'"'));e.name="Mqtt Error",l.end(),(0,c.isFunction)(i)&&i(e)}))}(n,e,t,0,0,(function(n){return r(n)}),(function(n){return u(n)}))}));return o},f=function(n,e,t,r){n.subscribe(e,{qos:2},(function(e){e?(0,c.isFunction)(r)&&r(e):n.on("message",(function(n,e){var r;(0,c.isFunction)(t)&&t((r=e,(0,s.parseCurrentSettings)(r.toString(),{})))}))}));return function(t){return n.unsubscribe(e,{},t)}},d=function(n,e){return n.end((function(){(0,c.isFunction)(e)&&e()}))},m=t(7104),p=t(8808),v=1e4,h=function(n){var e;return(0,o.Z)((0,o.Z)({},n),{},{_id:(0,p.d9)(m.me.broadcast,null===(e=n.kind)||void 0===e?void 0:e.kind,n.name),protocol:null!==n&&void 0!==n&&n.protocol?null===n||void 0===n?void 0:n.protocol:m.Bh,port:null!==n&&void 0!==n&&n.port?null===n||void 0===n?void 0:n.port:m.QT})},w=function(n){var e=n._id,t=n.name,c=n.kind,a=n.deviceId,s=void 0===a?e||"".concat(c,"_").concat(t):a,p=n.url,v=n.protocol,h=void 0===v?m.Bh:v,w=n.port,x=void 0===w?m.QT:w,Z=n.topic,b=(n.username,n.password,new Promise(function(){var n=(0,u.Z)((0,r.Z)().mark((function n(e,t){var u,c;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,l(p,h,x);case 3:u=n.sent,c=(0,i.Z)(s),e({subscribe:function(n,e){return f(u,Z,(function(e){c.put((0,o.Z)({_id:"".concat(Date.now(),"_").concat(e.epoch)},e)).then((function(){return n(e)})).catch((function(){}))}),e)},disconnect:function(n){return d(u,n)},getAllData:function(){return c.getAll().then((function(n){return n.rows.map((function(n){return n.doc}))}))},getLastData:function(){return c.getAll({descending:!0,limit:1}).then((function(n){return n.rows.map((function(n){return n.doc}))}))},getPageData:function(n,e){return c.getAll({descending:!0,skip:n,limit:e}).then((function(n){return n.rows.map((function(n){return n.doc}))}))},getAllDataCount:function(){return c.getAll().then((function(n){return n.total_rows}))}}),n.next=17;break;case 14:n.prev=14,n.t0=n.catch(0),t(n.t0);case 17:case"end":return n.stop()}}),n,null,[[0,14]])})));return function(e,t){return n.apply(this,arguments)}}()));return b},x=function(n){var e=n.url,t=n.protocol,o=void 0===t?m.Bh:t,c=n.port,i=void 0===c?m.QT:c,a=n.topic,s=(n.username,n.password,new Promise(function(){var n=(0,u.Z)((0,r.Z)().mark((function n(t,u){var c,s;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,l(e,o,i);case 3:c=n.sent,s=f(c,a,(function(n){s(),d(c,(function(){return t(n)}))}),u),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),u(n.t0);case 10:case"end":return n.stop()}}),n,null,[[0,7]])})));return function(e,t){return n.apply(this,arguments)}}()));return s},Z=function(){var n=(0,u.Z)((0,r.Z)().mark((function n(e,t){var o,i,a,s=arguments;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=s.length>2&&void 0!==s[2]?s[2]:v,i=function(){var n=(0,u.Z)((0,r.Z)().mark((function n(){var u;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(u=[],e.forEach((function(n){return u.push(x(n).then((function(e){return{device:n,payload:e}})).catch((function(e){throw e.device=n,e})))})),n.t0=(0,c.isFunction)(t),!n.t0){n.next=9;break}return n.t1=t,n.next=7,Promise.allSettled(u);case 7:n.t2=n.sent,(0,n.t1)(n.t2);case 9:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),i(),a=setInterval((0,u.Z)((0,r.Z)().mark((function n(){return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,i();case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n)}))),o),n.abrupt("return",a);case 5:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()},6917:function(n,e,t){"use strict";var r=t(4165),u=t(1413),o=t(5861),c=t(1853),i={};e.Z=function(n){var e=function(){return n in i||(i[n]=new c.Z(n,{revs_limit:1,auto_compaction:!0})),i[n]},t=function(){var n=(0,o.Z)((0,r.Z)().mark((function n(t){return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise((function(n,r){e().allDocs((0,u.Z)({include_docs:!0},t)).then((function(e){return n(e)})).catch((function(n){return r(n)}))})));case 1:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return{getInfo:function(){return new Promise((function(n,t){e().info().then((function(e){return n(e)})).catch((function(n){return t(n)}))}))},getAll:t,get:function(n){return new Promise((function(t,r){var u=e();n?u.get(n).then((function(n){return t(n)})).catch((function(n){return r(n)})):r(new Error("Doc fetch : docId is required"))}))},put:function(n){return new Promise((function(t,r){var u=e();"_id"in n?u.put(n).then((function(n){return t(n)})).catch((function(n){return r(n)})):r(new Error("Doc create : _id is required in doc"))}))},update:function(n){return new Promise((function(t,r){var o=e();"_id"in n?o.get(n._id).then((function(e){return o.put((0,u.Z)((0,u.Z)({},n),{},{_rev:e._rev})).then((function(n){return t(n)})).catch((function(n){return r(n)}))})).catch((function(n){return r(n)})):r(new Error("Doc update : _id is required in doc"))}))},remove:function(n){return new Promise((function(t,r){var u=e();n?u.get(n).then((function(e){return u.remove({_id:n,_rev:e._rev}).then((function(n){return t(n)})).catch((function(n){return r(n)}))})).catch((function(n){return r(n)})):r(new Error("Doc remove : docId is required"))}))},listenToChanges:function(n,t,r){return e().changes((0,u.Z)({since:"now",live:!0,include_docs:!0},r)).on("change",n).on("error",t)},close:function(){var t=e();return delete i[n],t.close()},destroy:function(){var t=e();return delete i[n],t.destroy()}}}},7104:function(n,e,t){"use strict";t.d(e,{Bh:function(){return s},GZ:function(){return i},PH:function(){return d},QT:function(){return a},cV:function(){return m},me:function(){return f},uv:function(){return l}});var r=t(4925),u=t(3938),o=t.n(u),c=["events","parameters"],i="BIOREACTOR-UI_devices",a="https:"===window.location.protocol?"443":"80",s="https:"===window.location.protocol?"wss":"http",l=["http","tcp","wss"],f={broadcast:"broadcast",interactive:"interactive",local:"local"},d={help:"h",settings:"u",compactSettings:"uc",runExperiment:"r",kinetic:"k",reset:"ur1234",sleep:"l",setParameter:function(n,e){return"".concat(n).concat(e)}},m=Object.keys(o()).filter((function(n){return o()[n].kind})).map((function(n){var e=o()[n];e.events,e.parameters;return(0,r.Z)(e,c)}))},8808:function(n,e,t){"use strict";t.d(e,{$n:function(){return N},Aj:function(){return m},C7:function(){return Z},D4:function(){return g},Gu:function(){return j},PW:function(){return p},S6:function(){return x},_A:function(){return k},_v:function(){return v},d9:function(){return f},h1:function(){return _},n1:function(){return w},w3:function(){return b},xN:function(){return d},xl:function(){return h},xs:function(){return C}});var r=t(4165),u=t(5861),o=t(1413),c=t(3938),i=t.n(c),a=t(6917),s=t(7104),l=function(n,e){console.log(n);var t=new Error("".concat(e," \n").concat(null===n||void 0===n?void 0:n.message));throw t.name="DATABASE_ERROR",t},f=function(n,e,t){return"".concat(n,"_").concat(e,"_").concat(t)},d=function(n){try{if(n)return i().fromDeviceID(Number(n))}catch(e){return void console.log(e)}},m=function(n,e){var t,r;return n&&e?null===(t=i()[n])||void 0===t||null===(r=t.parameters)||void 0===r?void 0:r.map((function(n){return(0,o.Z)((0,o.Z)({},n),{},{value:e[n.label]})})):void 0},p=function(){var n=(0,u.Z)((0,r.Z)().mark((function n(e){return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,a.Z)(s.GZ).getAll({startkey:"".concat(e),endkey:"".concat(e,"\uffff")}).then((function(n){return n.rows.map((function(n){return n.doc}))})).catch((function(n){return l(n,"Get locally saved devices error")})));case 1:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),v=function(){var n=(0,u.Z)((0,r.Z)().mark((function n(e){return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,a.Z)(s.GZ).get(e).catch((function(n){return l(n,"Get device error")})));case 1:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),h=function(){var n=(0,u.Z)((0,r.Z)().mark((function n(e){return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,a.Z)(s.GZ).update(e).catch((function(n){return l(n,"Update device error")})));case 1:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),w=function(n){return(0,a.Z)(s.GZ).remove(n).catch((function(n){return l(n,"Delete device error")}))},x=function(n){return(0,a.Z)(s.GZ).put(n).catch((function(n){return"conflict"===n.name?l(n,"Device name must be unique"):l(n,"Insert device error")}))},Z=function(n,e){return(0,a.Z)(n).put((0,o.Z)({_id:Date.now().toString()},e))},b=function(n){return(0,a.Z)(n).getAll({descending:!0}).then((function(n){return n.rows.map((function(n){return n.doc}))}))},g=function(n,e,t){return(0,a.Z)(n).getAll({descending:!0,skip:(e-1)*t,limit:t}).then((function(n){return n.rows.map((function(n){return n.doc}))}))},k=function(n){return(0,a.Z)(n).getAll({include_docs:!1}).then((function(n){return n.total_rows}))},j=function(n){return(0,a.Z)(n).getAll({descending:!0,limit:1}).then((function(n){return n.rows.map((function(n){return n.doc}))}))},_=function(n){return(0,a.Z)(n).destroy()},C=function(n,e,t){return(0,a.Z)(n).listenToChanges(e,t)},N=function(n){return(0,a.Z)(n).close()}},5525:function(){},2361:function(){},4616:function(){}}]);
//# sourceMappingURL=610.6d188a38.chunk.js.map