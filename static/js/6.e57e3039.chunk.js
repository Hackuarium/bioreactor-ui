(this["webpackJsonpbioreactor-ui"]=this["webpackJsonpbioreactor-ui"]||[]).push([[6],{103:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(4),c=n(15),a=n(0);function o(){var e=Object(c.M)(),t=function(t,n,c){var o=c.textColor,s=c.Icon,i=c.timeout;e.addNotification({title:Object(a.jsx)("span",{className:Object(r.a)("text-base font-semibold",o+"500"),children:t}),content:Object(a.jsx)("span",{className:"text-sm text-neutral-500",children:n}),icon:Object(a.jsx)(s,{className:Object(r.a)("w-8 h-8",o+"600")})},i)};return{addErrorNotification:function(e,n){t(e,n,{textColor:"text-danger-",Icon:c.E,timeout:5e3})},addWarningNotification:function(e,n){t(e,n,{textColor:"text-warning-",Icon:c.E,timeout:2500})},addInfoNotification:function(e,n){t(e,n,{textColor:"text-primary-",Icon:c.v,timeout:1e3})}}}},120:function(e,t,n){"use strict";n.d(t,"e",(function(){return x})),n.d(t,"d",(function(){return O})),n.d(t,"f",(function(){return h})),n.d(t,"c",(function(){return v})),n.d(t,"a",(function(){return w})),n.d(t,"b",(function(){return g}));var r=n(1),c=n(35),a=n.n(c),o=n(44),s=n(160),i=n(91);var u,l=function(){var e=null,t={};return{connect:function(n){(!e||t&&t.db_name!==n)&&((e=new s.a(n)).info().then((function(e){return t=e})),console.log('connected to DB "'.concat(n,'"')));return{getInfo:function(){return t},put:function(t){return"_id"in t?e.put(t):Promise.reject(new Error("doc must include _id"))},get:function(t){return e.get(t)},getAll:function(){var t=Object(o.a)(a.a.mark((function t(n){var c;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.allDocs(Object(r.a)({include_docs:!0},n));case 2:return c=t.sent,t.abrupt("return",c.rows);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),getAllCount:function(){var t=Object(o.a)(a.a.mark((function t(n){var c;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.allDocs(Object(r.a)({include_docs:!0},n));case 2:return c=t.sent,t.abrupt("return",c.total_rows);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),update:function(t){return"_id"in t?e.get(t._id).then((function(n){return e.put(Object(r.a)(Object(r.a)({},t),{},{_rev:n._rev}))})):Promise.reject(new Error("doc must include _id"))},remove:function(t){return e.get(t).then((function(n){return e.remove({_id:t,_rev:n._rev})}))},removeAll:function(){return e.destroy().then((function(t){e=null,console.log('DB "'.concat(n,'" destroyed : ')+JSON.stringify(t))}))},close:function(t){return e.close((function(){e=null,console.log('DB "'.concat(n,'" closed')),Object(i.isFunction)(t)&&t()}))}}}}}(),d=n(162),m=n.n(d),f=n(135),b=n(90),j=function(e,t,n,r,c){return new Promise((function(a,o){!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b.c,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b.b,r=arguments.length>5?arguments[5]:void 0,c=arguments.length>6?arguments[6]:void 0;u&&u.connected&&u.options.hostname===e&&Object(i.isFunction)(r)&&r(u);var a="".concat(t,"://").concat(e,":").concat(n);(u=m.a.connect(a,{keepalive:300,reconnectPeriod:5e3})).on("connect",(function(){console.log("connected to ".concat(a," : ").concat(u.connected)),Object(i.isFunction)(r)&&r(u)})),u.stream.on("error",(function(e){console.log(e);var t=new Error("Couldn't connect to BROKER \"".concat(a,'"'));t.name="Mqtt Error",u.end(),Object(i.isFunction)(c)&&c(t)}))}(e,t,n,r,c,(function(e){return a(e)}),(function(e){return o(e)}))}))},p=function(e,t,n,r){e.subscribe(t,{qos:2},(function(t){t?Object(i.isFunction)(r)&&r(t):e.on("message",(function(e,t){var r;Object(i.isFunction)(n)&&n((r=t,Object(f.parseCurrentSettings)(r.toString(),{})))}))}));return function(n){return e.unsubscribe(t,{},n)}},x=function(){var e=Object(o.a)(a.a.mark((function e(){var t,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l.connect(b.d),e.next=3,t.getAll();case 3:return n=e.sent,e.abrupt("return",n.map((function(e){return e.doc})));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),O=function(){var e=Object(o.a)(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.connect(b.d),e.next=3,n.get(t);case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),h=function(){var e=Object(o.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.connect(b.d),e.abrupt("return",n.update(t));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=function(e){return l.connect(b.d).remove(e).catch((function(e){var t=new Error("Couldn't remove record: ".concat(e.message));throw t.name="Database Error",t}))},w=function(e){var t=l.connect(b.d),n=e.kind,r=e.name,c=e.url,a=e.protocol,o=e.port,s=e.topic,i=e.username,u=e.password;for(var d in e)if(!e[d])throw new Error("Field missing [".concat(d,"]"));var m="".concat(n,"_").concat(r);return t.get(m).then((function(e){var t=new Error("Another device exists with the same name");throw t.payload={exist:!0,payload:e},t})).catch((function(e){if(e.payload&&e.payload.exist)throw e;return t.put({_id:m,name:r,url:c,protocol:a,port:o,topic:s,kind:n,username:i,password:u}).then((function(e){return{exist:!1,inserted:!0,payload:e}})).catch((function(e){var t=new Error(e.toString());throw t.payload={exist:!1,inserted:!1,payload:e.toString()},t}))}))},g=function(e){var t=e._id,n=e.name,c=e.kind,s=e.deviceId,u=void 0===s?t||"".concat(c,"_").concat(n):s,d=e.url,m=e.protocol,f=e.port,b=e.topic,x=e.username,O=e.password;return new Promise(function(){var e=Object(o.a)(a.a.mark((function e(t,n){var c,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j(d,m,f,x,O);case 3:c=e.sent,o=l.connect(u),t({subscribe:function(e,t){return p(c,b,(function(t){o.put(Object(r.a)({_id:Date.now().toString()},t)),Object(i.isFunction)(e)&&e(t)}),t)},disconnect:function(){return t=function(){return o.close()},(e=c).end((function(){console.log('mqtt broker "'.concat(e.options.hostname,'" disconnected')),Object(i.isFunction)(t)&&t()}));var e,t},getAllData:function(){return o.getAll()},getLastData:function(){return o.getAll({descending:!0,limit:1})},getPageDate:function(e,t){return o.getAll({descending:!0,skip:e,limit:t})},getAllDataCount:function(){return o.getAllCount()}}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),n(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t,n){return e.apply(this,arguments)}}())}},161:function(e,t){},167:function(e,t){},168:function(e,t){},181:function(e,t){},182:function(e,t){},186:function(e,t){},187:function(e,t){},386:function(e,t,n){"use strict";n.r(t);var r=n(35),c=n.n(r),a=n(44),o=n(6),s=n(2),i=n(91),u=n(15),l=n(0),d=function(e){var t=e.data,n=e.onSelect,r=e.onEdit,d=e.onDelete,m=Object(s.useState)(),f=Object(o.a)(m,2),b=f[0],j=f[1],p=function(){var e=Object(a.a)(c.a.mark((function e(t,r){var a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:b||(j(t),a=function(){return j(null)},Object(i.isFunction)(n)&&n(t,r,a));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return Object(l.jsx)("div",{className:"overflow-hidden bg-white shadow sm:rounded-md",children:t.map((function(e){return Object(l.jsxs)("li",{className:"block transition duration-150 ease-in-out hover:bg-gray-50 focus:outline-none focus:bg-gray-50 cursor-pointer",onClick:function(t){return p(e,t)},children:[Object(l.jsxs)("div",{className:"relative flex items-center px-4 py-4 sm:px-6",children:[b===e&&Object(l.jsx)("div",{className:"absolute top-0 left-0 w-full h-full opacity-30 bg-neutral-300",children:Object(l.jsx)("div",{className:"w-full h-full flex justify-center items-center",children:Object(l.jsx)(u.l,{className:"w-8 h-8 text-primary-800"})})}),Object(l.jsx)("div",{className:"flex items-center flex-1 min-w-0",children:Object(l.jsxs)("div",{className:"flex-1 min-w-0 px-4 sm:grid sm:grid-col-2 sm:gap-4",children:[Object(l.jsx)("p",{className:"col-span-2 text-lg font-semibold truncate text-primary-700",children:e.name}),Object(l.jsxs)("div",{className:"flex flex-col text-xs font-italic text-neutral-600",children:[Object(l.jsxs)("p",{className:"truncate",children:[Object(l.jsx)("span",{className:"font-semibold",children:"Device kind : "}),e.kind]}),Object(l.jsxs)("p",{className:"truncate",children:[Object(l.jsx)("span",{className:"font-semibold",children:"URL : "}),"".concat(e.protocol,"://").concat(e.url,":").concat(e.port)]}),Object(l.jsxs)("p",{className:"truncate",children:[Object(l.jsx)("span",{className:"font-semibold",children:"Topic : "}),e.topic]})]}),Object(l.jsxs)("div",{className:"pt-2 sm:pt-0 flex justify-end items-center cursor-default",children:[Object(l.jsx)("button",{className:"mx-1 p-2 border rounded shadow-sm bg-neutral-100 focus:outline-none active:bg-neutral-200",onClick:function(t){return r(e,t)},children:Object(l.jsx)(u.D,{className:"text-gray-700"})}),Object(l.jsx)("button",{className:"mx-1 p-2 border rounded shadow-sm bg-neutral-100 focus:outline-none active:bg-neutral-200",onClick:function(t){return d(e,t)},children:Object(l.jsx)(u.F,{className:"text-gray-700"})})]})]})}),Object(l.jsx)("div",{children:Object(l.jsx)(u.q,{className:"w-5 h-5 text-neutral-400"})})]}),Object(l.jsx)("div",{className:"w-full border-t border-neutral-100"})]},e.kind+e.name)}))})},m=n(1),f=n(374),b=n(120),j=n(90),p=j.f.map((function(e){return{label:e.toUpperCase(),value:e}})),x=j.e.map((function(e){return{label:e,value:e}})),O=f.b().shape({name:f.c().max(50,"Name too Long!").matches(/^[A-z0-9_-]*$/,"Field supports only : letters / numbers / _ / - ").required("Required"),url:f.c().required("Required"),port:f.a().positive().integer(),protocol:f.c(),kind:f.c().required("Required"),topic:f.c().required("Required"),username:f.c().required("Required")}),h=function(e){var t=e.isOpen,n=e.onClose,r=e.onSave,d=e.onUpdate,f=e.initialValues,j=!Object(i.isEmpty)(f),h=Object(s.useState)(Object(l.jsx)("div",{})),v=Object(o.a)(h,2),w=v[0],g=v[1],N=Object(s.useRef)(null),y=Object(m.a)({name:"123",url:"mqtt.beemos.org",protocol:p[0].value,port:"9001",kind:x[0].value,topic:"lpatiny/Computer/server",username:"testUser",password:"word"},f),k=function(){var e=Object(a.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!j){e.next=8;break}if(e.t0=Object(i.isFunction)(d),!e.t0){e.next=6;break}return e.next=6,d(t);case 6:e.next=12;break;case 8:if(e.t1=Object(i.isFunction)(r),!e.t1){e.next=12;break}return e.next=12,r(t);case 12:Object(i.isFunction)(n)&&n(),e.next=18;break;case 15:throw e.prev=15,e.t2=e.catch(0),new Error(e.t2.message);case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t){return e.apply(this,arguments)}}();Object(s.useEffect)((function(){!t&&setTimeout((function(){return g(Object(l.jsx)("div",{}))}),500)}),[t]);var C=function(e,t){switch(e){case"connecting":return Object(l.jsxs)("div",{className:"mx-6 flex flex-row items-center text-sm text-left text-neutral-500",children:[Object(l.jsx)(u.l,{className:"w-6 h-6 mr-2"}),Object(l.jsx)("span",{children:t})]});case"success":return Object(l.jsxs)("div",{className:"mx-4 flex flex-row items-center text-sm text-left text-success-500",children:[Object(l.jsx)(u.p,{className:"h-6 w-6 mr-4"}),Object(l.jsx)("span",{children:t})]});case"error":return Object(l.jsxs)("div",{className:"mx-4 flex flex-row items-center text-sm text-left text-danger-500",children:[Object(l.jsx)(u.C,{className:"h-6 w-6 mr-4"}),Object(l.jsx)("span",{children:t})]});default:return Object(l.jsx)("div",{})}};return Object(l.jsxs)(u.h,{isOpen:t,onRequestClose:n,icon:Object(l.jsx)(u.z,{}),iconColor:"neutral",animated:!0,hasCloseButton:!0,requestCloseOnBackdrop:!0,requestCloseOnEsc:!0,fluid:!0,wrapperComponent:u.d,wrapperProps:{innerRef:N,initialValues:y,validationSchema:O,onSubmit:k,className:"h-full"},children:[Object(l.jsx)(u.h.Header,{children:"Connect New Device"}),Object(l.jsxs)(u.h.Body,{children:[Object(l.jsxs)("div",{className:"p-2 mt-2",children:[Object(l.jsx)(u.g,{name:"name",id:"name",label:"Custom name",placeholder:"device_123",disabled:j,required:!0,className:"w-full",inputClassName:"w-full"}),Object(l.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between mt-4 sm:mt-0 border-t border-neutral sm:border-0",children:[Object(l.jsx)(u.g,{name:"url",id:"url",label:"URL",placeholder:"mqtt.domain.com",required:!0,leadingInlineAddon:Object(l.jsx)(u.x,{}),className:"mt-4 sm:mr-4 w-full sm:w-1/2",inputClassName:"w-full"}),Object(l.jsxs)("div",{className:"flex flex-row justify-between items-start flex-1",children:[Object(l.jsx)(u.k,{name:"protocol",id:"protocol",label:"Protocol",options:p,renderOption:function(e){return"".concat(e.label)},getValue:function(e){return e.value},className:"mt-4 mr-4 w-1/2",inputClassName:"w-full"}),Object(l.jsx)(u.g,{name:"port",id:"port",label:"Port",className:"mt-4 flex-1",inputClassName:"w-full"})]})]}),Object(l.jsxs)("div",{className:"flex flex-row justify-between items-start",children:[Object(l.jsx)(u.k,{name:"kind",id:"kind",label:"Device kind",options:x,renderOption:function(e){return"".concat(e.label)},getValue:function(e){return e.value},required:!0,className:"mt-4 mr-4 w-1/3 ",inputClassName:"w-full bg-gray-500"}),Object(l.jsx)(u.g,{name:"topic",id:"topic",label:"Topic",required:!0,className:"mt-4 flex-1",inputClassName:"w-full"})]}),Object(l.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between mt-4 sm:mt-0 border-t border-neutral sm:border-0",children:[Object(l.jsx)(u.g,{name:"username",id:"username",label:"Username",placeholder:"Username",required:!0,leadingInlineAddon:Object(l.jsx)(u.B,{}),className:"mt-4 w-full sm:mr-4 sm:w-1/2",inputClassName:"w-full"}),Object(l.jsx)(u.g,{name:"password",id:"password",label:"Password",type:"password",placeholder:"********",required:!0,leadingInlineAddon:Object(l.jsx)(u.w,{}),className:"mt-4 w-full sm:flex-1",inputClassName:"w-full"})]})]}),Object(l.jsx)(u.e,{})]}),Object(l.jsx)(u.h.Footer,{children:Object(l.jsxs)("div",{className:"flex flex-col sm:flex-row items-center",children:[w,Object(l.jsx)("button",{onClick:function(e){e.stopPropagation(),g(C("connecting","Connecting ...")),setTimeout((function(){Object(b.b)(N.current.values).then((function(e){g(C("success","Connected"))})).catch((function(e){g(C("error","Connection Error: ".concat(e.message)))}))}),500)},type:"button",className:"w-full sm:w-max mt-2 sm:my-0 px-4 py-2 sm:mr-4 text-sm font-semibold text-neutral-700 border rounded-md shadow bg-neutral-200 focus:outline-none flex-1 sm:flex-none",children:"Test connection"}),Object(l.jsx)(u.m,{className:"w-full my-2 sm:my-0 sm:w-max ",children:j?"Update":"Add"})]})})]})},v=n(103);t.default=function(e){var t=e.history,n=e.match,r=Object(s.useState)(!1),m=Object(o.a)(r,2),f=m[0],j=m[1],p=Object(s.useState)(!1),x=Object(o.a)(p,2),O=x[0],w=x[1],g=Object(s.useState)([]),N=Object(o.a)(g,2),y=N[0],k=N[1],C=Object(s.useState)({}),q=Object(o.a)(C,2),_=q[0],E=q[1],A=Object(v.a)().addErrorNotification;Object(s.useEffect)((function(){Object(b.e)().then((function(e){return k(e)}))}),[f]);return Object(l.jsxs)("div",{className:"p-8",children:[Object(l.jsx)("h2",{className:"text-3xl font-semibold mb-12 lg:mb-16",children:"Broadcast devices"}),Object(l.jsx)("div",{className:"w-full flex justify-end mb-6 lg:mb-8",children:Object(l.jsx)(u.a,{onClick:function(){E({}),w(!0)},children:"Add device"})}),Object(l.jsxs)("div",{children:[Object(l.jsxs)("div",{className:"w-full my-2 flex flex-row items-center ",children:[Object(l.jsx)("h3",{className:"w-max ml-2 mr-4 text-neutral-600 text-sm whitespace-nowrap ",children:"Available devices"}),Object(l.jsx)("div",{className:"w-full border-t border-neutral-300"})]}),Object(l.jsx)(d,{data:y,onSelect:function(e,r,o){setTimeout(Object(a.a)(c.a.mark((function r(){return c.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,Object(b.b)(e);case 3:Object(i.isFunction)(o)&&o(),t.push(n.url+"/device/"+e._id),r.next=11;break;case 7:r.prev=7,r.t0=r.catch(0),A(r.t0.name,r.t0.message),Object(i.isFunction)(o)&&o();case 11:case"end":return r.stop()}}),r,null,[[0,7]])}))),500)},onEdit:function(e,t){t.stopPropagation(),E(e),w(!0)},onDelete:function(e,t){t.stopPropagation(),Object(b.c)(e._id).then((function(){return j(!f)})).catch((function(e){return A(e.name,e.message)}))}})]}),Object(l.jsx)(h,{isOpen:O,onClose:function(){j(!f),w(!1)},initialValues:_,onSave:b.a,onUpdate:b.f})]})}},90:function(e,t,n){"use strict";n.d(t,"d",(function(){return a})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return s})),n.d(t,"f",(function(){return i})),n.d(t,"e",(function(){return u})),n.d(t,"a",(function(){return l}));var r=n(102),c=n.n(r),a="BIOREACTOR_devices",o="9001",s="tcp",i=["tcp","http"],u=Object.keys(c.a).map((function(e){return c.a[e].kind})),l={compactSettings:"uc",runExpirement:"r",kinetic:"k",reset:"ur1234",sleep:"l",setParameter:function(e,t){return"".concat(e).concat(t)}}}}]);
//# sourceMappingURL=6.e57e3039.chunk.js.map