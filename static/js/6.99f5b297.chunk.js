(this["webpackJsonpbioreactor-ui"]=this["webpackJsonpbioreactor-ui"]||[]).push([[6],{100:function(n,t,e){"use strict";e.d(t,"c",(function(){return r})),e.d(t,"a",(function(){return c})),e.d(t,"b",(function(){return o})),e.d(t,"e",(function(){return u})),e.d(t,"d",(function(){return i}));var r="BIOREACTOR_devices",c="9001",o="tcp",u=["tcp","http"],i=["computer","beemos","openBio","openBio6","openSpectro","simpleSpectro","solar2015"]},117:function(n,t,e){"use strict";e.d(t,"e",(function(){return m})),e.d(t,"d",(function(){return j})),e.d(t,"f",(function(){return O})),e.d(t,"c",(function(){return g})),e.d(t,"a",(function(){return w})),e.d(t,"b",(function(){return x}));var r=e(1),c=e(35),o=e.n(c),u=e(45),i=e(157),a=e(91);var s,f=function(){var n=null,t={};return{connect:function(e){(!n||t&&t.db_name!==e)&&((n=new i.a(e)).info().then((function(n){return t=n})),console.log('connected to DB "'.concat(e,'"')));return{getInfo:function(){return t},put:function(t){return"_id"in t?n.put(t):Promise.reject(new Error("doc must include _id"))},get:function(t){return n.get(t)},getAll:function(){var t=Object(u.a)(o.a.mark((function t(e){var c;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.allDocs(Object(r.a)({include_docs:!0},e));case 2:return c=t.sent,t.abrupt("return",c.rows);case 4:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}(),update:function(t){return"_id"in t?n.get(t._id).then((function(e){return n.put(Object(r.a)(Object(r.a)({},t),{},{_rev:e._rev}))})):Promise.reject(new Error("doc must include _id"))},remove:function(t){return n.get(t).then((function(e){return n.remove({_id:t,_rev:e._rev})}))},removeAll:function(){return n.destroy().then((function(t){n=null,console.log('DB "'.concat(e,'" destroyed : ')+JSON.stringify(t))}))},close:function(t){return n.close((function(){n=null,console.log('DB "'.concat(e,'" closed')),Object(a.isFunction)(t)&&t()}))}}}}}(),d=e(159),p=e.n(d),l=e(190),b=e(100),v=function(n,t,e,r,c){return new Promise((function(o,u){!function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b.b,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b.a,r=arguments.length>5?arguments[5]:void 0,c=arguments.length>6?arguments[6]:void 0;s&&s.connected&&s.options.hostname===n&&Object(a.isFunction)(r)&&r(s);var o="".concat(t,"://").concat(n,":").concat(e);(s=p.a.connect(o,{keepalive:300,reconnectPeriod:5e3})).on("connect",(function(){console.log("connected to ".concat(o," : ").concat(s.connected)),Object(a.isFunction)(r)&&r(s)})),s.stream.on("error",(function(n){console.log(n);var t=new Error("Couldn't connect to BROKER \"".concat(o,'"'));t.name="Mqtt Error",s.end(),Object(a.isFunction)(c)&&c(t)}))}(n,t,e,r,c,(function(n){return o(n)}),(function(n){return u(n)}))}))},h=function(n,t,e,r){n.subscribe(t,{qos:2},(function(t){t?Object(a.isFunction)(r)&&r(t):n.on("message",(function(n,t){var r;Object(a.isFunction)(e)&&e((r=t,Object(l.parseCurrentSettings)(r.toString(),{})))}))}));return function(e){return n.unsubscribe(t,{},e)}},m=function(){var n=Object(u.a)(o.a.mark((function n(){var t,e;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=f.connect(b.c),n.next=3,t.getAll();case 3:return e=n.sent,n.abrupt("return",e.map((function(n){return n.doc})));case 5:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),j=function(){var n=Object(u.a)(o.a.mark((function n(t){var e,r;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e=f.connect(b.c),n.next=3,e.get(t);case 3:return r=n.sent,n.abrupt("return",r);case 5:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}(),O=function(){var n=Object(u.a)(o.a.mark((function n(t){var e;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e=f.connect(b.c),n.abrupt("return",e.update(t));case 2:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}(),g=function(n){return f.connect(b.c).remove(n).catch((function(n){var t=new Error("Couldn't remove record: ".concat(n.message));throw t.name="Database Error",t}))},w=function(n){var t=f.connect(b.c),e=n.kind,r=n.name,c=n.url,o=n.protocol,u=n.port,i=n.topic,a=n.username,s=n.password;for(var d in n)if(!n[d])throw new Error("Field missing [".concat(d,"]"));var p="".concat(e,"_").concat(r);return t.get(p).then((function(n){var t=new Error("Another device exists with the same name");throw t.payload={exist:!0,payload:n},t})).catch((function(n){if(n.payload&&n.payload.exist)throw n;return t.put({_id:p,name:r,url:c,protocol:o,port:u,topic:i,kind:e,username:a,password:s}).then((function(n){return{exist:!1,inserted:!0,payload:n}})).catch((function(n){var t=new Error(n.toString());throw t.payload={exist:!1,inserted:!1,payload:n.toString()},t}))}))},x=function(n){var t=n._id,e=n.name,c=n.kind,i=n.deviceId,s=void 0===i?t||"".concat(c,"_").concat(e):i,d=n.url,p=n.protocol,l=n.port,b=n.topic,m=n.username,j=n.password;return new Promise(function(){var n=Object(u.a)(o.a.mark((function n(t,e){var c,u;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,v(d,p,l,m,j);case 3:c=n.sent,u=f.connect(s),t({subscribe:function(n,t){return h(c,b,(function(t){u.put(Object(r.a)({_id:Date.now().toString()},t)),Object(a.isFunction)(n)&&n(t)}),t)},disconnect:function(){return t=function(){return u.close()},(n=c).end((function(){console.log('mqtt broker "'.concat(n.options.hostname,'" disconnected')),Object(a.isFunction)(t)&&t()}));var n,t},getAllData:function(){return u.getAll()},getLastData:function(){return u.getAll({descending:!0,limit:1})}}),n.next=15;break;case 12:n.prev=12,n.t0=n.catch(0),e(n.t0);case 15:case"end":return n.stop()}}),n,null,[[0,12]])})));return function(t,e){return n.apply(this,arguments)}}())}},158:function(n,t){},164:function(n,t){},165:function(n,t){},178:function(n,t){},179:function(n,t){},183:function(n,t){},184:function(n,t){},376:function(n,t,e){"use strict";e.r(t);var r=e(20),c=e(6),o=e(117),u=e(3),i=e(0);t.default=function(n){var t=n.match,e=Object(u.useState)([]),a=Object(c.a)(e,2),s=a[0],f=a[1],d=Object(u.useState)(),p=Object(c.a)(d,2),l=p[0],b=p[1],v="".concat(t.params.id);return Object(u.useEffect)((function(){v&&Object(o.d)(v).then((function(n){Object(o.b)(n).then((function(n){return b(n)}))}))}),[v]),Object(u.useEffect)((function(){l&&l.subscribe((function(n){return f([n].concat(Object(r.a)(s)))}),(function(n){return console.log(n)}))}),[l]),Object(i.jsxs)("div",{children:[Object(i.jsx)("div",{children:"Device Details"}),Object(i.jsx)("p",{children:v}),Object(i.jsx)("p",{children:JSON.stringify(s[0])})]})}}}]);
//# sourceMappingURL=6.99f5b297.chunk.js.map