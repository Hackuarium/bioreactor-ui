"use strict";(self.webpackChunkbioreactor_ui=self.webpackChunkbioreactor_ui||[]).push([[231],{2096:function(e){var t=function(){var e=new Error("Delay aborted");return e.name="AbortError",e},r=function(e){var r=e.clearTimeout,n=e.setTimeout,i=e.willResolve;return function(e){var a,s,u,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=o.value,h=o.signal;if(h&&h.aborted)return Promise.reject(t());var l=r||clearTimeout,f=function(){l(a),u(t())},d=new Promise((function(t,r){s=function(){h&&h.removeEventListener("abort",f),i?t(c):r(c)},u=r,a=(n||setTimeout)(s,e)}));return h&&h.addEventListener("abort",f,{once:!0}),d.clear=function(){l(a),a=null,s()},d}},n=r({willResolve:!0});n.reject=r({willResolve:!1}),n.range=function(e,t,r){return n(function(e,t){return Math.floor(Math.random()*(t-e+1)+e)}(e,t),r)},n.createWithTimers=function(e){var t=e.clearTimeout,n=e.setTimeout,i=r({clearTimeout:t,setTimeout:n,willResolve:!0});return i.reject=r({clearTimeout:t,setTimeout:n,willResolve:!1}),i},e.exports=n,e.exports.default=n},8231:function(e,t,r){r.d(t,{w:function(){return m}});var n=r(7762),i=r(4165),a=r(5861),s=r(5671),u=r(3144),o=r(136),c=r(7277),h=r(2096),l=r.n(h),f=0,d=function(){function e(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,s.Z)(this,e),this.currentTimeout=void 0,this.command=t,this.timeout=void 0===n.timeout?1e3:n.timeout,this.answer="",this.status=f,this.creationTimestamp=Date.now(),this.promise=new Promise((function(e,t){r.reject=t,r.resolve=e})),this.finishedPromise=new Promise((function(e){r.finished=e}))}return(0,u.Z)(e,[{key:"isFinished",value:function(){return 4===this.status||5===this.status}},{key:"setTimeout",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){var e=this;this.currentTimeout&&clearTimeout(this.currentTimeout),this.currentTimeout=setTimeout((function(){4!==e.status&&5!==e.status&&(e.status=5,e.reject("Timeout"),e.finished())}),this.timeout)}))},{key:"start",value:function(){this.startTimestamp=Date.now(),this.status=1,this.setTimeout()}},{key:"appendAnswer",value:function(e){var t=(new TextDecoder).decode(e);if(this.status=2,this.answer+=t,this.answer.replace(/\r/g,"").endsWith("\n\n")){var r=this.answer.split(/\r?\n/);r.length>0&&""===r[r.length-1]&&(r=r.filter((function(e){return e})),this.status=3,this.resolve(r.join("\n")),this.finished(),this.status=4)}}}]),e}(),v=1,p=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,s.Z)(this,e),this.status=v,this.id=void 0,this.serialPort=t,this.baudRate=r.baudRate||115200,this.queue=[],this.action=void 0,this.interCommandDelay=r.interCommandDelay,this.defaultCommandExpirationDelay=2e3,this.encoder=new TextEncoder,this.decoder=new TextDecoder}return(0,u.Z)(e,[{key:"isReady",value:function(){return 2===this.status}},{key:"ensureProcessQueue",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.currentProcessQueue||(this.currentProcessQueue=this.runProcessQueue()),e.abrupt("return",this.currentProcessQueue);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"runProcessQueue",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.queue.length>0)){e.next=15;break}if(this.action=this.queue.shift(),!this.action){e.next=13;break}return this.action.start(),e.next=6,this.write("".concat(this.action.command,"\n"));case 6:return e.next=8,this.read(this.action);case 8:return e.next=10,this.action.finishedPromise;case 10:return this.action=void 0,e.next=13,l()(this.interCommandDelay);case 13:e.next=0;break;case 15:this.currentProcessQueue=void 0;case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getStatus",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{value:this.status});case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"ensureOpen",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(2===this.status){e.next=3;break}return e.abrupt("return",this.open());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"open",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,this.serialPort.open({baudRate:this.baudRate});case 3:return this.reader=this.serialPort.readable.getReader(),this.writer=this.serialPort.writable.getWriter(),e.next=7,this.get("uq");case 7:this.id=e.sent,this.status=2;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,s=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(s.length>1&&void 0!==s[1]?s[1]:{}).commandExpirationDelay,n=void 0===r?this.defaultCommandExpirationDelay:r,a=new d(t,{timeout:n}),this.queue.push(a),this.ensureProcessQueue(),e.abrupt("return",a.promise);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"error",value:function(e){"Error ".concat(this.port.path),this.status=10,this.emit("adapter",{event:"Error",value:e})}},{key:"close",value:function(){this.status=3}},{key:"write",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.encoder.encode("".concat(t,"\n")),e.abrupt("return",this.writer.write(r));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"read",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isFinished()){e.next=9;break}return e.t0=t,e.next=4,this.reader.read();case 4:e.t1=e.sent.value,e.t0.appendAnswer.call(e.t0,e.t1),l()(10),e.next=0;break;case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();var m=function(e){(0,o.Z)(r,e);var t=(0,c.Z)(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.Z)(this,r),n=t.call(this),function(e){e||(console.error("Web serial doesn't seem to be enabled in your browser. Try enabling it by visiting:"),console.error("chrome://flags/#enable-experimental-web-platform-features"),console.error("opera://flags/#enable-experimental-web-platform-features"),console.error("edge://flags/#enable-experimental-web-platform-features"))}(e),n.serial=e,n.devices=[],n.portFilter=void 0===i.portFilter?[{usbProductId:37384,usbVendorId:6991}]:i.portFilter,n.baudRate=i.baudRate||115200,n.interCommandDelay=void 0===i.interCommandDelay?100:i.interCommandDelay,n.defaultCommandExpirationDelay=void 0===i.defaultCommandExpirationDelay?100:i.defaultCommandExpirationDelay,n}return(0,u.Z)(r,[{key:"requestDevices",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.serial.requestPort({filters:this.portFilter});case 2:return e.abrupt("return",this.updateDevices());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateDevices",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,r,a,s,u,o,c,h,l=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.serial.getPorts();case 2:t=e.sent,r=this.devices.filter((function(e){return!t.includes(e.serialPort)})),a=(0,n.Z)(r);try{for(a.s();!(s=a.n()).done;)9!==(u=s.value).status&&3!==u.status&&u.close(),u.status=9}catch(f){a.e(f)}finally{a.f()}o=(0,n.Z)(t),e.prev=8,h=(0,i.Z)().mark((function e(){var t,r,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=c.value,!(r=l.devices.filter((function(e){return e.serialPort===t}))[0])){e.next=7;break}return e.next=5,r.ensureOpen();case 5:e.next=11;break;case 7:return n=new p(t,{baudRate:l.baudRate,interCommandDelay:l.interCommandDelay,defaultCommandExpirationDelay:l.defaultCommandExpirationDelay}),l.devices.push(n),e.next=11,n.open();case 11:case"end":return e.stop()}}),e)})),o.s();case 11:if((c=o.n()).done){e.next=15;break}return e.delegateYield(h(),"t0",13);case 13:e.next=11;break;case 15:e.next=20;break;case 17:e.prev=17,e.t1=e.catch(8),o.e(e.t1);case 20:return e.prev=20,o.f(),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[8,17,20,23]])})));return function(){return e.apply(this,arguments)}}()},{key:"continuousUpdateDevices",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,r,n,a,s=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=(t=s.length>0&&void 0!==s[0]?s[0]:{}).scanInterval,n=void 0===r?1e3:r,a=t.callback;case 2:return e.next=5,this.updateDevices();case 5:return a&&a(this.devices),e.next=8,l()(n);case 8:e.next=2;break;case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getDevicesList",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).ready,t=void 0!==e&&e;return this.devices.filter((function(e){return!t||e.isReady()})).map((function(e){return{status:e.status,id:e.id,queueLength:e.queue.length}}))}},{key:"findDevice",value:function(e){if(void 0!==e){var t=this.devices.filter((function(t){return t.id===e&&2===t.status}));if(0!==t.length){if(t.length>1)throw new Error("Many devices have the same id: ".concat(e));return t[0]}}}},{key:"sendCommand",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.findDevice(t)){e.next=3;break}throw Error("Device ".concat(t," not found"));case 3:if(!n||!n.isReady()){e.next=5;break}return e.abrupt("return",n.get(r));case 5:throw Error("Device ".concat(t," not ready: ").concat(n.port.path));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(function(){function e(){(0,s.Z)(this,e),this.callbacks={}}return(0,u.Z)(e,[{key:"on",value:function(e,t){this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t)}},{key:"emit",value:function(e,t){var r=this.callbacks[e];r&&r.forEach((function(e){return e(t)}))}}]),e}())}}]);
//# sourceMappingURL=231.fe9b98ca.chunk.js.map